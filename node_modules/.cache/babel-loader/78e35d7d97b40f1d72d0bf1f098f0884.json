{"ast":null,"code":"'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n/* global webkitRTCPeerConnection, mozRTCPeerConnection, mozRTCSessionDescription, mozRTCIceCandidate */\n\n\nvar RTCPeerConnectionShim = require('rtcpeerconnection-shim');\n\nvar Log = require('../log').default;\n\nvar _require = require('./sdp'),\n    setCodecPreferences = _require.setCodecPreferences,\n    setMaxAverageBitrate = _require.setMaxAverageBitrate;\n\nvar util = require('../util');\n\nfunction RTCPC() {\n  if (typeof window === 'undefined') {\n    this.log.info('No RTCPeerConnection implementation available. The window object was not found.');\n    return;\n  }\n\n  if (util.isLegacyEdge()) {\n    this.RTCPeerConnection = new RTCPeerConnectionShim(typeof window !== 'undefined' ? window : global);\n  } else if (typeof window.RTCPeerConnection === 'function') {\n    this.RTCPeerConnection = window.RTCPeerConnection;\n  } else if (typeof window.webkitRTCPeerConnection === 'function') {\n    this.RTCPeerConnection = webkitRTCPeerConnection;\n  } else if (typeof window.mozRTCPeerConnection === 'function') {\n    this.RTCPeerConnection = mozRTCPeerConnection;\n    window.RTCSessionDescription = mozRTCSessionDescription;\n    window.RTCIceCandidate = mozRTCIceCandidate;\n  } else {\n    this.log.info('No RTCPeerConnection implementation available');\n  }\n}\n\nRTCPC.prototype.create = function (rtcConstraints, rtcConfiguration) {\n  this.log = Log.getInstance();\n  this.pc = new this.RTCPeerConnection(rtcConfiguration, rtcConstraints);\n};\n\nRTCPC.prototype.createModernConstraints = function (c) {\n  // createOffer differs between Chrome 23 and Chrome 24+.\n  // See https://groups.google.com/forum/?fromgroups=#!topic/discuss-webrtc/JBDZtrMumyU\n  // Unfortunately I haven't figured out a way to detect which format\n  // is required ahead of time, so we'll first try the old way, and\n  // if we get an exception, then we'll try the new way.\n  if (typeof c === 'undefined') {\n    return null;\n  } // NOTE(mroberts): As of Chrome 38, Chrome still appears to expect\n  // constraints under the 'mandatory' key, and with the first letter of each\n  // constraint capitalized. Firefox, on the other hand, has deprecated the\n  // 'mandatory' key and does not expect the first letter of each constraint\n  // capitalized.\n\n\n  var nc = Object.assign({}, c);\n\n  if (typeof webkitRTCPeerConnection !== 'undefined' && !util.isLegacyEdge()) {\n    nc.mandatory = {};\n\n    if (typeof c.audio !== 'undefined') {\n      nc.mandatory.OfferToReceiveAudio = c.audio;\n    }\n\n    if (typeof c.video !== 'undefined') {\n      nc.mandatory.OfferToReceiveVideo = c.video;\n    }\n  } else {\n    if (typeof c.audio !== 'undefined') {\n      nc.offerToReceiveAudio = c.audio;\n    }\n\n    if (typeof c.video !== 'undefined') {\n      nc.offerToReceiveVideo = c.video;\n    }\n  }\n\n  delete nc.audio;\n  delete nc.video;\n  return nc;\n};\n\nRTCPC.prototype.createOffer = function (maxAverageBitrate, codecPreferences, constraints, onSuccess, onError) {\n  var _this = this;\n\n  constraints = this.createModernConstraints(constraints);\n  return promisifyCreate(this.pc.createOffer, this.pc)(constraints).then(function (offer) {\n    if (!_this.pc) {\n      return Promise.resolve();\n    }\n\n    var sdp = setMaxAverageBitrate(offer.sdp, maxAverageBitrate);\n    return promisifySet(_this.pc.setLocalDescription, _this.pc)(new RTCSessionDescription({\n      type: 'offer',\n      sdp: setCodecPreferences(sdp, codecPreferences)\n    }));\n  }).then(onSuccess, onError);\n};\n\nRTCPC.prototype.createAnswer = function (maxAverageBitrate, codecPreferences, constraints, onSuccess, onError) {\n  var _this2 = this;\n\n  constraints = this.createModernConstraints(constraints);\n  return promisifyCreate(this.pc.createAnswer, this.pc)(constraints).then(function (answer) {\n    if (!_this2.pc) {\n      return Promise.resolve();\n    }\n\n    var sdp = setMaxAverageBitrate(answer.sdp, maxAverageBitrate);\n    return promisifySet(_this2.pc.setLocalDescription, _this2.pc)(new RTCSessionDescription({\n      type: 'answer',\n      sdp: setCodecPreferences(sdp, codecPreferences)\n    }));\n  }).then(onSuccess, onError);\n};\n\nRTCPC.prototype.processSDP = function (maxAverageBitrate, codecPreferences, sdp, constraints, onSuccess, onError) {\n  var _this3 = this;\n\n  sdp = setCodecPreferences(sdp, codecPreferences);\n  var desc = new RTCSessionDescription({\n    sdp: sdp,\n    type: 'offer'\n  });\n  return promisifySet(this.pc.setRemoteDescription, this.pc)(desc).then(function () {\n    _this3.createAnswer(maxAverageBitrate, codecPreferences, constraints, onSuccess, onError);\n  });\n};\n\nRTCPC.prototype.getSDP = function () {\n  return this.pc.localDescription.sdp;\n};\n\nRTCPC.prototype.processAnswer = function (codecPreferences, sdp, onSuccess, onError) {\n  if (!this.pc) {\n    return Promise.resolve();\n  }\n\n  sdp = setCodecPreferences(sdp, codecPreferences);\n  return promisifySet(this.pc.setRemoteDescription, this.pc)(new RTCSessionDescription({\n    sdp: sdp,\n    type: 'answer'\n  })).then(onSuccess, onError);\n};\n/* NOTE(mroberts): Firefox 18 through 21 include a `mozRTCPeerConnection`\n   object, but attempting to instantiate it will throw the error\n\n       Error: PeerConnection not enabled (did you set the pref?)\n\n   unless the `media.peerconnection.enabled` pref is enabled. So we need to test\n   if we can actually instantiate `mozRTCPeerConnection`; however, if the user\n   *has* enabled `media.peerconnection.enabled`, we need to perform the same\n   test that we use to detect Firefox 24 and above, namely:\n\n       typeof (new mozRTCPeerConnection()).getLocalStreams === 'function'\n\n\n    NOTE(rrowland): We no longer support Legacy Edge as of Sep 1, 2020.\n*/\n\n\nRTCPC.test = function () {\n  if ((typeof navigator === 'undefined' ? 'undefined' : _typeof(navigator)) === 'object') {\n    var getUserMedia = navigator.mediaDevices && navigator.mediaDevices.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.getUserMedia;\n\n    if (util.isLegacyEdge(navigator)) {\n      return false;\n    }\n\n    if (getUserMedia && typeof window.RTCPeerConnection === 'function') {\n      return true;\n    } else if (getUserMedia && typeof window.webkitRTCPeerConnection === 'function') {\n      return true;\n    } else if (getUserMedia && typeof window.mozRTCPeerConnection === 'function') {\n      try {\n        // eslint-disable-next-line babel/new-cap\n        var test = new window.mozRTCPeerConnection();\n        if (typeof test.getLocalStreams !== 'function') return false;\n      } catch (e) {\n        return false;\n      }\n\n      return true;\n    } else if (typeof RTCIceGatherer !== 'undefined') {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nfunction promisify(fn, ctx, areCallbacksFirst) {\n  return function () {\n    var args = Array.prototype.slice.call(arguments);\n    return new Promise(function (resolve) {\n      resolve(fn.apply(ctx, args));\n    }).catch(function () {\n      return new Promise(function (resolve, reject) {\n        fn.apply(ctx, areCallbacksFirst ? [resolve, reject].concat(args) : args.concat([resolve, reject]));\n      });\n    });\n  };\n}\n\nfunction promisifyCreate(fn, ctx) {\n  return promisify(fn, ctx, true);\n}\n\nfunction promisifySet(fn, ctx) {\n  return promisify(fn, ctx, false);\n}\n\nmodule.exports = RTCPC;","map":{"version":3,"sources":["/root/twilio-phone-client/node_modules/twilio-client/es5/twilio/rtc/rtcpc.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","RTCPeerConnectionShim","require","Log","default","_require","setCodecPreferences","setMaxAverageBitrate","util","RTCPC","window","log","info","isLegacyEdge","RTCPeerConnection","global","webkitRTCPeerConnection","mozRTCPeerConnection","RTCSessionDescription","mozRTCSessionDescription","RTCIceCandidate","mozRTCIceCandidate","create","rtcConstraints","rtcConfiguration","getInstance","pc","createModernConstraints","c","nc","Object","assign","mandatory","audio","OfferToReceiveAudio","video","OfferToReceiveVideo","offerToReceiveAudio","offerToReceiveVideo","createOffer","maxAverageBitrate","codecPreferences","constraints","onSuccess","onError","_this","promisifyCreate","then","offer","Promise","resolve","sdp","promisifySet","setLocalDescription","type","createAnswer","_this2","answer","processSDP","_this3","desc","setRemoteDescription","getSDP","localDescription","processAnswer","test","navigator","getUserMedia","mediaDevices","webkitGetUserMedia","mozGetUserMedia","getLocalStreams","e","RTCIceGatherer","promisify","fn","ctx","areCallbacksFirst","args","Array","slice","call","arguments","apply","catch","reject","concat","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/* global webkitRTCPeerConnection, mozRTCPeerConnection, mozRTCSessionDescription, mozRTCIceCandidate */\nvar RTCPeerConnectionShim = require('rtcpeerconnection-shim');\nvar Log = require('../log').default;\n\nvar _require = require('./sdp'),\n    setCodecPreferences = _require.setCodecPreferences,\n    setMaxAverageBitrate = _require.setMaxAverageBitrate;\n\nvar util = require('../util');\n\nfunction RTCPC() {\n  if (typeof window === 'undefined') {\n    this.log.info('No RTCPeerConnection implementation available. The window object was not found.');\n    return;\n  }\n\n  if (util.isLegacyEdge()) {\n    this.RTCPeerConnection = new RTCPeerConnectionShim(typeof window !== 'undefined' ? window : global);\n  } else if (typeof window.RTCPeerConnection === 'function') {\n    this.RTCPeerConnection = window.RTCPeerConnection;\n  } else if (typeof window.webkitRTCPeerConnection === 'function') {\n    this.RTCPeerConnection = webkitRTCPeerConnection;\n  } else if (typeof window.mozRTCPeerConnection === 'function') {\n    this.RTCPeerConnection = mozRTCPeerConnection;\n    window.RTCSessionDescription = mozRTCSessionDescription;\n    window.RTCIceCandidate = mozRTCIceCandidate;\n  } else {\n    this.log.info('No RTCPeerConnection implementation available');\n  }\n}\n\nRTCPC.prototype.create = function (rtcConstraints, rtcConfiguration) {\n  this.log = Log.getInstance();\n  this.pc = new this.RTCPeerConnection(rtcConfiguration, rtcConstraints);\n};\nRTCPC.prototype.createModernConstraints = function (c) {\n  // createOffer differs between Chrome 23 and Chrome 24+.\n  // See https://groups.google.com/forum/?fromgroups=#!topic/discuss-webrtc/JBDZtrMumyU\n  // Unfortunately I haven't figured out a way to detect which format\n  // is required ahead of time, so we'll first try the old way, and\n  // if we get an exception, then we'll try the new way.\n  if (typeof c === 'undefined') {\n    return null;\n  }\n  // NOTE(mroberts): As of Chrome 38, Chrome still appears to expect\n  // constraints under the 'mandatory' key, and with the first letter of each\n  // constraint capitalized. Firefox, on the other hand, has deprecated the\n  // 'mandatory' key and does not expect the first letter of each constraint\n  // capitalized.\n  var nc = Object.assign({}, c);\n  if (typeof webkitRTCPeerConnection !== 'undefined' && !util.isLegacyEdge()) {\n    nc.mandatory = {};\n    if (typeof c.audio !== 'undefined') {\n      nc.mandatory.OfferToReceiveAudio = c.audio;\n    }\n    if (typeof c.video !== 'undefined') {\n      nc.mandatory.OfferToReceiveVideo = c.video;\n    }\n  } else {\n    if (typeof c.audio !== 'undefined') {\n      nc.offerToReceiveAudio = c.audio;\n    }\n    if (typeof c.video !== 'undefined') {\n      nc.offerToReceiveVideo = c.video;\n    }\n  }\n\n  delete nc.audio;\n  delete nc.video;\n\n  return nc;\n};\nRTCPC.prototype.createOffer = function (maxAverageBitrate, codecPreferences, constraints, onSuccess, onError) {\n  var _this = this;\n\n  constraints = this.createModernConstraints(constraints);\n  return promisifyCreate(this.pc.createOffer, this.pc)(constraints).then(function (offer) {\n    if (!_this.pc) {\n      return Promise.resolve();\n    }\n\n    var sdp = setMaxAverageBitrate(offer.sdp, maxAverageBitrate);\n\n    return promisifySet(_this.pc.setLocalDescription, _this.pc)(new RTCSessionDescription({\n      type: 'offer',\n      sdp: setCodecPreferences(sdp, codecPreferences)\n    }));\n  }).then(onSuccess, onError);\n};\nRTCPC.prototype.createAnswer = function (maxAverageBitrate, codecPreferences, constraints, onSuccess, onError) {\n  var _this2 = this;\n\n  constraints = this.createModernConstraints(constraints);\n  return promisifyCreate(this.pc.createAnswer, this.pc)(constraints).then(function (answer) {\n    if (!_this2.pc) {\n      return Promise.resolve();\n    }\n    var sdp = setMaxAverageBitrate(answer.sdp, maxAverageBitrate);\n\n    return promisifySet(_this2.pc.setLocalDescription, _this2.pc)(new RTCSessionDescription({\n      type: 'answer',\n      sdp: setCodecPreferences(sdp, codecPreferences)\n    }));\n  }).then(onSuccess, onError);\n};\nRTCPC.prototype.processSDP = function (maxAverageBitrate, codecPreferences, sdp, constraints, onSuccess, onError) {\n  var _this3 = this;\n\n  sdp = setCodecPreferences(sdp, codecPreferences);\n  var desc = new RTCSessionDescription({ sdp: sdp, type: 'offer' });\n  return promisifySet(this.pc.setRemoteDescription, this.pc)(desc).then(function () {\n    _this3.createAnswer(maxAverageBitrate, codecPreferences, constraints, onSuccess, onError);\n  });\n};\nRTCPC.prototype.getSDP = function () {\n  return this.pc.localDescription.sdp;\n};\nRTCPC.prototype.processAnswer = function (codecPreferences, sdp, onSuccess, onError) {\n  if (!this.pc) {\n    return Promise.resolve();\n  }\n  sdp = setCodecPreferences(sdp, codecPreferences);\n\n  return promisifySet(this.pc.setRemoteDescription, this.pc)(new RTCSessionDescription({ sdp: sdp, type: 'answer' })).then(onSuccess, onError);\n};\n/* NOTE(mroberts): Firefox 18 through 21 include a `mozRTCPeerConnection`\n   object, but attempting to instantiate it will throw the error\n\n       Error: PeerConnection not enabled (did you set the pref?)\n\n   unless the `media.peerconnection.enabled` pref is enabled. So we need to test\n   if we can actually instantiate `mozRTCPeerConnection`; however, if the user\n   *has* enabled `media.peerconnection.enabled`, we need to perform the same\n   test that we use to detect Firefox 24 and above, namely:\n\n       typeof (new mozRTCPeerConnection()).getLocalStreams === 'function'\n\n\n    NOTE(rrowland): We no longer support Legacy Edge as of Sep 1, 2020.\n*/\nRTCPC.test = function () {\n  if ((typeof navigator === 'undefined' ? 'undefined' : _typeof(navigator)) === 'object') {\n    var getUserMedia = navigator.mediaDevices && navigator.mediaDevices.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.getUserMedia;\n\n    if (util.isLegacyEdge(navigator)) {\n      return false;\n    }\n\n    if (getUserMedia && typeof window.RTCPeerConnection === 'function') {\n      return true;\n    } else if (getUserMedia && typeof window.webkitRTCPeerConnection === 'function') {\n      return true;\n    } else if (getUserMedia && typeof window.mozRTCPeerConnection === 'function') {\n      try {\n        // eslint-disable-next-line babel/new-cap\n        var test = new window.mozRTCPeerConnection();\n        if (typeof test.getLocalStreams !== 'function') return false;\n      } catch (e) {\n        return false;\n      }\n      return true;\n    } else if (typeof RTCIceGatherer !== 'undefined') {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nfunction promisify(fn, ctx, areCallbacksFirst) {\n  return function () {\n    var args = Array.prototype.slice.call(arguments);\n\n    return new Promise(function (resolve) {\n      resolve(fn.apply(ctx, args));\n    }).catch(function () {\n      return new Promise(function (resolve, reject) {\n        fn.apply(ctx, areCallbacksFirst ? [resolve, reject].concat(args) : args.concat([resolve, reject]));\n      });\n    });\n  };\n}\n\nfunction promisifyCreate(fn, ctx) {\n  return promisify(fn, ctx, true);\n}\n\nfunction promisifySet(fn, ctx) {\n  return promisify(fn, ctx, false);\n}\n\nmodule.exports = RTCPC;"]},"metadata":{},"sourceType":"script"}