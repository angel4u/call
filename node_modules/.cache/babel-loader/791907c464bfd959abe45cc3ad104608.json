{"ast":null,"code":"\"use strict\";\n\nvar _keys = require(\"babel-runtime/core-js/object/keys\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _toConsumableArray2 = require(\"babel-runtime/helpers/toConsumableArray\");\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _set = require(\"babel-runtime/core-js/set\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _promise = require(\"babel-runtime/core-js/promise\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _map = require(\"babel-runtime/core-js/map\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _stringify = require(\"babel-runtime/core-js/json/stringify\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _isInteger = require(\"babel-runtime/core-js/number/is-integer\");\n\nvar _isInteger2 = _interopRequireDefault(_isInteger);\n\nvar _getPrototypeOf = require(\"babel-runtime/core-js/object/get-prototype-of\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar events_1 = require(\"events\");\n\nvar logger_1 = require(\"./logger\");\n\nvar members_1 = require(\"./data/members\");\n\nvar member_1 = require(\"./member\");\n\nvar messages_1 = require(\"./data/messages\");\n\nvar util_1 = require(\"./util\");\n\nvar log = logger_1.Logger.scope('Channel');\nvar fieldMappings = {\n  lastMessage: 'lastMessage',\n  attributes: 'attributes',\n  createdBy: 'createdBy',\n  dateCreated: 'dateCreated',\n  dateUpdated: 'dateUpdated',\n  friendlyName: 'friendlyName',\n  lastConsumedMessageIndex: 'lastConsumedMessageIndex',\n  notificationLevel: 'notificationLevel',\n  sid: 'sid',\n  status: 'status',\n  type: 'type',\n  uniqueName: 'uniqueName',\n  state: 'state'\n};\n\nfunction parseTime(timeString) {\n  try {\n    return new Date(timeString);\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction filterStatus(status) {\n  switch (status) {\n    case 'notParticipating':\n      return 'known';\n\n    default:\n      return status;\n  }\n}\n\nexports.filterStatus = filterStatus;\n/**\n * @classdesc A Channel represents a remote channel of communication between multiple Programmable Chat Clients\n * @property {Object} attributes - The Channel's custom attributes\n * @property {String} createdBy - The identity of the User that created this Channel\n * @property {Date} dateCreated - The Date this Channel was created\n * @property {Date} dateUpdated - The Date this Channel was last updated\n * @property {String} friendlyName - The Channel's name\n * @property {Boolean} isPrivate - Whether the channel is private (as opposed to public)\n * @property {Number} lastConsumedMessageIndex - Index of the last Message the User has consumed in this Channel\n * @property {Channel#LastMessage} lastMessage - Last Message sent to this Channel\n * @property {Channel#NotificationLevel} notificationLevel - User Notification level for this Channel\n * @property {String} sid - The Channel's unique system identifier\n * @property {Channel#State} state - The Channel's state\n * @property {Channel#Status} status - The Channel's status\n * @property {Channel#Type} type - The Channel's type\n * @property {String} uniqueName - The Channel's unique name (tag)\n * @fires Channel#memberJoined\n * @fires Channel#memberLeft\n * @fires Channel#memberUpdated\n * @fires Channel#messageAdded\n * @fires Channel#messageRemoved\n * @fires Channel#messageUpdated\n * @fires Channel#typingEnded\n * @fires Channel#typingStarted\n * @fires Channel#updated\n * @fires Channel#removed\n */\n\nvar Channel = function (_events_1$EventEmitte) {\n  (0, _inherits3.default)(Channel, _events_1$EventEmitte);\n  /**\n   * These options can be passed to {@link Channel#sendMessage}.\n   * @typedef {Object} Channel#SendMediaOptions\n   * @property {String} contentType - content type of media\n   * @property {String | Buffer} media - content to post\n   */\n\n  /**\n   * The update reason for <code>updated</code> event emitted on Channel\n   * @typedef {('attributes' | 'createdBy' | 'dateCreated' | 'dateUpdated' |\n    'friendlyName' | 'lastConsumedMessageIndex' | 'state' | 'status' | 'uniqueName' | 'lastMessage' |\n    'notificationLevel' )} Channel#UpdateReason\n   */\n\n  /**\n   * The status of the Channel, relative to the Client: whether the Channel\n   * is <code>known</code> to local Client, Client is <code>invited</code> to or\n   * is <code>joined</code> to this Channel\n   * @typedef {('unknown' | 'known' | 'invited' | 'joined')} Channel#Status\n   */\n\n  /**\n   * The type of Channel (<code>public</code> or <code>private</code>).\n   * @typedef {('public' | 'private')} Channel#Type\n   */\n\n  /**\n   * The User's Notification level for Channel, determines whether the currently logged-in User will receive\n   * pushes for events in this Channel. Can be either <code>muted</code> or <code>default</code>,\n   * where <code>default</code> defers to global Service push configuration.\n   * @typedef {('default' | 'muted')} Channel#NotificationLevel\n   */\n\n  /**\n   * The Channel's state. Set to undefined if the channel is not a conversation.\n   * @typedef {Object | undefined} Channel#State\n   * @property {('active' | 'inactive' | 'closed')} current - the current state\n   * @property {Date} dateUpdated - date at which the latest channel state update happened\n   */\n\n  function Channel(services, descriptor, sid) {\n    (0, _classCallCheck3.default)(this, Channel);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (Channel.__proto__ || (0, _getPrototypeOf2.default)(Channel)).call(this));\n\n    var attributes = descriptor.attributes || {};\n    var createdBy = descriptor.createdBy;\n    var dateCreated = parseTime(descriptor.dateCreated);\n    var dateUpdated = parseTime(descriptor.dateUpdated);\n    var friendlyName = descriptor.friendlyName || null;\n    var lastConsumedMessageIndex = (0, _isInteger2.default)(descriptor.lastConsumedMessageIndex) ? descriptor.lastConsumedMessageIndex : null;\n    var uniqueName = descriptor.uniqueName || null;\n\n    try {\n      (0, _stringify2.default)(attributes);\n    } catch (e) {\n      throw new Error('Attributes must be a valid JSON object.');\n    }\n\n    _this.services = services;\n    _this.sid = sid;\n    _this.entityName = descriptor.channel;\n    _this.channelState = {\n      uniqueName: uniqueName,\n      status: 'known',\n      type: descriptor.type,\n      attributes: attributes,\n      createdBy: createdBy,\n      dateCreated: dateCreated,\n      dateUpdated: dateUpdated,\n      friendlyName: friendlyName,\n      lastConsumedMessageIndex: lastConsumedMessageIndex\n    };\n\n    if (descriptor.notificationLevel) {\n      _this.channelState.notificationLevel = descriptor.notificationLevel;\n    }\n\n    _this.members = new _map2.default();\n    _this.membersEntity = new members_1.Members(_this, _this.services, _this.members);\n\n    _this.membersEntity.on('memberJoined', _this.emit.bind(_this, 'memberJoined'));\n\n    _this.membersEntity.on('memberLeft', _this.emit.bind(_this, 'memberLeft'));\n\n    _this.membersEntity.on('memberUpdated', function (args) {\n      return _this.emit('memberUpdated', args);\n    });\n\n    _this.messagesEntity = new messages_1.Messages(_this, services);\n\n    _this.messagesEntity.on('messageAdded', function (message) {\n      return _this._onMessageAdded(message);\n    });\n\n    _this.messagesEntity.on('messageUpdated', function (args) {\n      return _this.emit('messageUpdated', args);\n    });\n\n    _this.messagesEntity.on('messageRemoved', _this.emit.bind(_this, 'messageRemoved'));\n\n    return _this;\n  }\n\n  (0, _createClass3.default)(Channel, [{\n    key: \"_subscribe\",\n\n    /**\n     * The Channel's last message's information.\n     * @typedef {Object} Channel#LastMessage\n     * @property {Number} index - Message's index\n     * @property {Date} timestamp - Message's creation timestamp\n     */\n\n    /**\n     * Load and Subscribe to this Channel and do not subscribe to its Members and Messages.\n     * This or _subscribeStreams will need to be called before any events on Channel will fire.\n     * @returns {Promise}\n     * @private\n     */\n    value: function _subscribe() {\n      var _this2 = this;\n\n      if (this.entityPromise) {\n        return this.entityPromise;\n      }\n\n      return this.entityPromise = this.entityPromise || this.services.syncClient.document({\n        id: this.entityName,\n        mode: 'open_existing'\n      }).then(function (entity) {\n        _this2.entity = entity;\n\n        _this2.entity.on('updated', function (args) {\n          _this2._update(args.value);\n        });\n\n        _this2.entity.on('removed', function () {\n          return _this2.emit('removed', _this2);\n        });\n\n        _this2._update(_this2.entity.value);\n\n        return entity;\n      }).catch(function (err) {\n        _this2.entity = null;\n        _this2.entityPromise = null;\n\n        if (_this2.services.syncClient.connectionState != 'disconnected') {\n          log.error('Failed to get channel object', err);\n        }\n\n        log.debug('ERROR: Failed to get channel object', err);\n        throw err;\n      });\n    }\n    /**\n     * Load the attributes of this Channel and instantiate its Members and Messages.\n     * This or _subscribe will need to be called before any events on Channel will fire.\n     * This will need to be called before any events on Members or Messages will fire\n     * @returns {Promise}\n     * @private\n     */\n\n  }, {\n    key: \"_subscribeStreams\",\n    value: function () {\n      var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n        var messagesObjectName, rosterObjectName;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return this._subscribe();\n\n              case 3:\n                log.trace('_subscribeStreams, this.entity.value=', this.entity.value);\n                messagesObjectName = this.entity.value.messages;\n                rosterObjectName = this.entity.value.roster;\n                _context.next = 8;\n                return _promise2.default.all([this.messagesEntity.subscribe(messagesObjectName), this.membersEntity.subscribe(rosterObjectName)]);\n\n              case 8:\n                _context.next = 15;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](0);\n\n                if (this.services.syncClient.connectionState !== 'disconnected') {\n                  log.error('Failed to subscribe on channel objects', this.sid, _context.t0);\n                }\n\n                log.debug('ERROR: Failed to subscribe on channel objects', this.sid, _context.t0);\n                throw _context.t0;\n\n              case 15:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 10]]);\n      }));\n\n      function _subscribeStreams() {\n        return _ref.apply(this, arguments);\n      }\n\n      return _subscribeStreams;\n    }()\n    /**\n     * Stop listening for and firing events on this Channel.\n     * @returns {Promise}\n     * @private\n     */\n\n  }, {\n    key: \"_unsubscribe\",\n    value: function () {\n      var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(this.isPrivate && this.entity)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                _context2.next = 3;\n                return this.entity.close();\n\n              case 3:\n                this.entity = null;\n                this.entityPromise = null;\n\n              case 5:\n                return _context2.abrupt(\"return\", _promise2.default.all([this.membersEntity.unsubscribe(), this.messagesEntity.unsubscribe()]));\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function _unsubscribe() {\n        return _ref2.apply(this, arguments);\n      }\n\n      return _unsubscribe;\n    }()\n    /**\n     * Set channel status\n     * @private\n     */\n\n  }, {\n    key: \"_setStatus\",\n    value: function _setStatus(status, source) {\n      var _this3 = this;\n\n      this.statusSource = source;\n\n      if (this.channelState.status === status) {\n        return;\n      }\n\n      this.channelState.status = status;\n\n      if (status === 'joined') {\n        this._subscribeStreams().catch(function (err) {\n          log.debug('ERROR while setting channel status ' + status, err);\n\n          if (_this3.services.syncClient.connectionState !== 'disconnected') {\n            throw err;\n          }\n        });\n      } else if (status === 'invited') {\n        this._subscribe().catch(function (err) {\n          log.debug('ERROR while setting channel status ' + status, err);\n\n          if (_this3.services.syncClient.connectionState !== 'disconnected') {\n            throw err;\n          }\n        });\n      } else if (this.entityPromise) {\n        this._unsubscribe().catch(function (err) {\n          log.debug('ERROR while setting channel status ' + status, err);\n\n          if (_this3.services.syncClient.connectionState !== 'disconnected') {\n            throw err;\n          }\n        });\n      }\n    }\n    /**\n     * If channel's status update source\n     * @private\n     * @return {Channels.DataSource}\n     */\n\n  }, {\n    key: \"_statusSource\",\n    value: function _statusSource() {\n      return this.statusSource;\n    }\n  }, {\n    key: \"_update\",\n\n    /**\n     * Updates local channel object with new values\n     * @private\n     */\n    value: function _update(update) {\n      var _a, _b, _c, _d, _e;\n\n      log.trace('_update', update);\n      Channel.preprocessUpdate(update, this.sid);\n      var updateReasons = new _set2.default();\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = (0, _getIterator3.default)((0, _keys2.default)(update)), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var key = _step.value;\n          var localKey = fieldMappings[key];\n\n          if (!localKey) {\n            continue;\n          }\n\n          switch (localKey) {\n            case fieldMappings.status:\n              if (!update.status || update.status === 'unknown' || this.channelState.status === filterStatus(update.status)) {\n                break;\n              }\n\n              this.channelState.status = filterStatus(update.status);\n              updateReasons.add(localKey);\n              break;\n\n            case fieldMappings.attributes:\n              if (util_1.isDeepEqual(this.channelState.attributes, update.attributes)) {\n                break;\n              }\n\n              this.channelState.attributes = update.attributes;\n              updateReasons.add(localKey);\n              break;\n\n            case fieldMappings.lastConsumedMessageIndex:\n              if (update.lastConsumedMessageIndex === undefined || update.lastConsumedMessageIndex === this.channelState.lastConsumedMessageIndex) {\n                break;\n              }\n\n              this.channelState.lastConsumedMessageIndex = update.lastConsumedMessageIndex;\n              updateReasons.add(localKey);\n              break;\n\n            case fieldMappings.lastMessage:\n              if (this.channelState.lastMessage && !update.lastMessage) {\n                delete this.channelState.lastMessage;\n                updateReasons.add(localKey);\n                break;\n              }\n\n              this.channelState.lastMessage = this.channelState.lastMessage || {};\n\n              if (((_a = update.lastMessage) === null || _a === void 0 ? void 0 : _a.index) !== undefined && update.lastMessage.index !== this.channelState.lastMessage.index) {\n                this.channelState.lastMessage.index = update.lastMessage.index;\n                updateReasons.add(localKey);\n              }\n\n              if (((_b = update.lastMessage) === null || _b === void 0 ? void 0 : _b.timestamp) !== undefined && ((_d = (_c = this.channelState.lastMessage) === null || _c === void 0 ? void 0 : _c.timestamp) === null || _d === void 0 ? void 0 : _d.getTime()) !== update.lastMessage.timestamp.getTime()) {\n                this.channelState.lastMessage.timestamp = update.lastMessage.timestamp;\n                updateReasons.add(localKey);\n              }\n\n              if (util_1.isDeepEqual(this.channelState.lastMessage, {})) {\n                delete this.channelState.lastMessage;\n              }\n\n              break;\n\n            case fieldMappings.state:\n              var state = update.state || undefined;\n\n              if (state !== undefined) {\n                state.dateUpdated = new Date(state.dateUpdated);\n              }\n\n              if (util_1.isDeepEqual(this.channelState.state, state)) {\n                break;\n              }\n\n              this.channelState.state = state;\n              updateReasons.add(localKey);\n              break;\n\n            default:\n              var isDate = update[key] instanceof Date;\n              var keysMatchAsDates = isDate && ((_e = this.channelState[localKey]) === null || _e === void 0 ? void 0 : _e.getTime()) === update[key].getTime();\n              var keysMatchAsNonDates = !isDate && this[localKey] === update[key];\n\n              if (keysMatchAsDates || keysMatchAsNonDates) {\n                break;\n              }\n\n              this.channelState[localKey] = update[key];\n              updateReasons.add(localKey);\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      if (updateReasons.size > 0) {\n        this.emit('updated', {\n          channel: this,\n          updateReasons: [].concat((0, _toConsumableArray3.default)(updateReasons))\n        });\n      }\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: \"_onMessageAdded\",\n    value: function _onMessageAdded(message) {\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = (0, _getIterator3.default)(this.members.values()), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var member = _step2.value;\n\n          if (member.identity === message.author) {\n            member._endTyping();\n\n            break;\n          }\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      this.emit('messageAdded', message);\n    }\n    /**\n     * Add a participant to the Channel by its Identity.\n     * @param {String} identity - Identity of the Client to add\n     * @returns {Promise<void|Error|SessionError>}\n     */\n\n  }, {\n    key: \"add\",\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(identity) {\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(!identity || typeof identity !== 'string')) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw new Error('Channel.add requires an <String>identity parameter');\n\n              case 2:\n                return _context3.abrupt(\"return\", this.membersEntity.add(identity));\n\n              case 3:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function add(_x) {\n        return _ref3.apply(this, arguments);\n      }\n\n      return add;\n    }()\n    /**\n     * Advance last consumed Channel's Message index to current consumption horizon.\n     * Rejects if User is not Member of Channel.\n     * Last consumed Message index is updated only if new index value is higher than previous.\n     * @param {Number} index - Message index to advance to as last read\n     * @returns {Promise<number|Error|SessionError>} resulting unread messages count in the channel\n     */\n\n  }, {\n    key: \"advanceLastConsumedMessageIndex\",\n    value: function () {\n      var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4(index) {\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if ((0, _isInteger2.default)(index)) {\n                  _context4.next = 2;\n                  break;\n                }\n\n                throw new Error('Channel.advanceLastConsumedMessageIndex requires an integral <Number>index parameter');\n\n              case 2:\n                _context4.next = 4;\n                return this._subscribeStreams();\n\n              case 4:\n                return _context4.abrupt(\"return\", this.services.consumptionHorizon.advanceLastConsumedMessageIndexForChannel(this.sid, index, this.lastConsumedMessageIndex));\n\n              case 5:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function advanceLastConsumedMessageIndex(_x2) {\n        return _ref4.apply(this, arguments);\n      }\n\n      return advanceLastConsumedMessageIndex;\n    }()\n    /**\n     * Decline an invitation to the Channel and unsubscribe from its events.\n     * @returns {Promise<Channel|SessionError>}\n     */\n\n  }, {\n    key: \"decline\",\n    value: function () {\n      var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5() {\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.services.session.addCommand('declineInvitation', {\n                  channelSid: this.sid\n                });\n\n              case 2:\n                return _context5.abrupt(\"return\", this);\n\n              case 3:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function decline() {\n        return _ref5.apply(this, arguments);\n      }\n\n      return decline;\n    }()\n    /**\n     * Delete the Channel and unsubscribe from its events.\n     * @returns {Promise<Channel|SessionError>}\n     */\n\n  }, {\n    key: \"delete\",\n    value: function () {\n      var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6() {\n        return _regenerator2.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this.services.session.addCommand('destroyChannel', {\n                  channelSid: this.sid\n                });\n\n              case 2:\n                return _context6.abrupt(\"return\", this);\n\n              case 3:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function _delete() {\n        return _ref6.apply(this, arguments);\n      }\n\n      return _delete;\n    }()\n    /**\n     * Get the custom attributes of this Channel.<br/>\n     *\n     * <i>NOTE: {@link Channel}'s <code>attributes</code> property will be empty for public channels until this function is called.</i>\n     * @returns {Promise<Object>}\n     */\n\n  }, {\n    key: \"getAttributes\",\n    value: function () {\n      var _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7() {\n        return _regenerator2.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this._subscribe();\n\n              case 2:\n                return _context7.abrupt(\"return\", this.attributes);\n\n              case 3:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function getAttributes() {\n        return _ref7.apply(this, arguments);\n      }\n\n      return getAttributes;\n    }()\n    /**\n     * Returns messages from channel using paginator interface.\n     * @param {Number} [pageSize=30] Number of messages to return in single chunk\n     * @param {Number} [anchor] - Index of newest Message to fetch. From the end by default\n     * @param {String} [direction=backwards] - Query direction. By default it query backwards\n     *                                         from newer to older. 'forward' will query in opposite direction\n     * @returns {Promise<Paginator<Message>>} page of messages\n     */\n\n  }, {\n    key: \"getMessages\",\n    value: function () {\n      var _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee8(pageSize, anchor, direction) {\n        return _regenerator2.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                if (!(typeof anchor !== 'undefined' && !(0, _isInteger2.default)(anchor))) {\n                  _context8.next = 2;\n                  break;\n                }\n\n                throw new Error('Anchor should be a valid message index');\n\n              case 2:\n                _context8.next = 4;\n                return this._subscribeStreams();\n\n              case 4:\n                return _context8.abrupt(\"return\", this.messagesEntity.getMessages(pageSize, anchor, direction));\n\n              case 5:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function getMessages(_x3, _x4, _x5) {\n        return _ref8.apply(this, arguments);\n      }\n\n      return getMessages;\n    }()\n    /**\n     * Get a list of all Members joined to this Channel.\n     * @returns {Promise<Array<Member>>}\n     */\n\n  }, {\n    key: \"getMembers\",\n    value: function () {\n      var _ref9 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee9() {\n        return _regenerator2.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return this._subscribeStreams();\n\n              case 2:\n                return _context9.abrupt(\"return\", this.membersEntity.getMembers());\n\n              case 3:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function getMembers() {\n        return _ref9.apply(this, arguments);\n      }\n\n      return getMembers;\n    }()\n    /**\n     * Get channel members count.\n     * <br/>\n     * This method is semi-realtime. This means that this data will be eventually correct,\n     * but will also possibly be incorrect for a few seconds. The Chat system does not\n     * provide real time events for counter values changes.\n     * <br/>\n     * So this is quite useful for any UI badges, but is not recommended\n     * to build any core application logic based on these counters being accurate in real time.\n     * @returns {Promise<number|Error>}\n     */\n\n  }, {\n    key: \"getMembersCount\",\n    value: function () {\n      var _ref10 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee10() {\n        var links, url, response;\n        return _regenerator2.default.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _context10.next = 2;\n                return this.services.session.getSessionLinks();\n\n              case 2:\n                links = _context10.sent;\n                url = new util_1.UriBuilder(links.publicChannelsUrl).path(this.sid).build();\n                _context10.next = 6;\n                return this.services.network.get(url);\n\n              case 6:\n                response = _context10.sent;\n                return _context10.abrupt(\"return\", response.body.members_count);\n\n              case 8:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function getMembersCount() {\n        return _ref10.apply(this, arguments);\n      }\n\n      return getMembersCount;\n    }()\n    /**\n     * Get a Member by its SID.\n     * @param {String} memberSid - Member sid\n     * @returns {Promise<Member>}\n     */\n\n  }, {\n    key: \"getMemberBySid\",\n    value: function () {\n      var _ref11 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee11(memberSid) {\n        return _regenerator2.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                if (!(!memberSid || typeof memberSid !== 'string')) {\n                  _context11.next = 2;\n                  break;\n                }\n\n                throw new Error('Channel.getMemberBySid requires a <String>memberSid parameter');\n\n              case 2:\n                return _context11.abrupt(\"return\", this.membersEntity.getMemberBySid(memberSid));\n\n              case 3:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function getMemberBySid(_x6) {\n        return _ref11.apply(this, arguments);\n      }\n\n      return getMemberBySid;\n    }()\n    /**\n     * Get a Member by its identity.\n     * @param {String} identity - Member identity\n     * @returns {Promise<Member>}\n     */\n\n  }, {\n    key: \"getMemberByIdentity\",\n    value: function () {\n      var _ref12 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee12(identity) {\n        return _regenerator2.default.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                if (!(!identity || typeof identity !== 'string')) {\n                  _context12.next = 2;\n                  break;\n                }\n\n                throw new Error('Channel.getMemberByIdentity requires a <String>identity parameter');\n\n              case 2:\n                return _context12.abrupt(\"return\", this.membersEntity.getMemberByIdentity(identity));\n\n              case 3:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function getMemberByIdentity(_x7) {\n        return _ref12.apply(this, arguments);\n      }\n\n      return getMemberByIdentity;\n    }()\n    /**\n     * Get total message count in a channel.\n     * <br/>\n     * This method is semi-realtime. This means that this data will be eventually correct,\n     * but will also possibly be incorrect for a few seconds. The Chat system does not\n     * provide real time events for counter values changes.\n     * <br/>\n     * So this is quite useful for any UI badges, but is not recommended\n     * to build any core application logic based on these counters being accurate in real time.\n     * @returns {Promise<number|Error>}\n     */\n\n  }, {\n    key: \"getMessagesCount\",\n    value: function () {\n      var _ref13 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee13() {\n        var links, url, response;\n        return _regenerator2.default.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _context13.next = 2;\n                return this.services.session.getSessionLinks();\n\n              case 2:\n                links = _context13.sent;\n                url = new util_1.UriBuilder(links.publicChannelsUrl).path(this.sid).build();\n                _context13.next = 6;\n                return this.services.network.get(url);\n\n              case 6:\n                response = _context13.sent;\n                return _context13.abrupt(\"return\", response.body.messages_count);\n\n              case 8:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function getMessagesCount() {\n        return _ref13.apply(this, arguments);\n      }\n\n      return getMessagesCount;\n    }()\n    /**\n     * Get unconsumed messages count for User if he is Member of this Channel.\n     * Rejects if User is not Member of Channel.\n     * <br/>\n     * This method is semi-realtime. This means that this data will be eventually correct,\n     * but will also possibly be incorrect for a few seconds. The Chat system does not\n     * provide real time events for counter values changes.\n     * <br/>\n     * So this is quite useful for any “unread messages count” badges, but is not recommended\n     * to build any core application logic based on these counters being accurate in real time.\n     * @returns {Promise<number|Error>}\n     */\n\n  }, {\n    key: \"getUnconsumedMessagesCount\",\n    value: function () {\n      var _ref14 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee14() {\n        var links, url, response;\n        return _regenerator2.default.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                _context14.next = 2;\n                return this.services.session.getSessionLinks();\n\n              case 2:\n                links = _context14.sent;\n                url = new util_1.UriBuilder(links.myChannelsUrl).arg('ChannelSid', this.sid).build();\n                _context14.next = 6;\n                return this.services.network.get(url);\n\n              case 6:\n                response = _context14.sent;\n\n                if (!(response.body.channels.length && response.body.channels[0].channel_sid == this.sid)) {\n                  _context14.next = 11;\n                  break;\n                }\n\n                if (!(typeof response.body.channels[0].unread_messages_count !== 'undefined' && response.body.channels[0].unread_messages_count != null)) {\n                  _context14.next = 10;\n                  break;\n                }\n\n                return _context14.abrupt(\"return\", response.body.channels[0].unread_messages_count);\n\n              case 10:\n                return _context14.abrupt(\"return\", null);\n\n              case 11:\n                throw new Error('Channel is not in user channels list');\n\n              case 12:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function getUnconsumedMessagesCount() {\n        return _ref14.apply(this, arguments);\n      }\n\n      return getUnconsumedMessagesCount;\n    }()\n    /**\n     * Invite a user to the Channel by their Identity.\n     * @param {String} identity - Identity of the user to invite\n     * @returns {Promise<void|Error|SessionError>}\n     */\n\n  }, {\n    key: \"invite\",\n    value: function () {\n      var _ref15 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee15(identity) {\n        return _regenerator2.default.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                if (!(typeof identity !== 'string' || !identity.length)) {\n                  _context15.next = 2;\n                  break;\n                }\n\n                throw new Error('Channel.invite requires an <String>identity parameter');\n\n              case 2:\n                _context15.next = 4;\n                return this.membersEntity.invite(identity);\n\n              case 4:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n\n      function invite(_x8) {\n        return _ref15.apply(this, arguments);\n      }\n\n      return invite;\n    }()\n    /**\n     * Join the Channel and subscribe to its events.\n     * @returns {Promise<Channel|SessionError>}\n     */\n\n  }, {\n    key: \"join\",\n    value: function () {\n      var _ref16 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee16() {\n        return _regenerator2.default.wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.next = 2;\n                return this.services.session.addCommand('joinChannelV2', {\n                  channelSid: this.sid\n                });\n\n              case 2:\n                return _context16.abrupt(\"return\", this);\n\n              case 3:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n\n      function join() {\n        return _ref16.apply(this, arguments);\n      }\n\n      return join;\n    }()\n    /**\n     * Leave the Channel.\n     * @returns {Promise<Channel|SessionError>}\n     */\n\n  }, {\n    key: \"leave\",\n    value: function () {\n      var _ref17 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee17() {\n        return _regenerator2.default.wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                if (!(this.channelState.status === 'joined')) {\n                  _context17.next = 3;\n                  break;\n                }\n\n                _context17.next = 3;\n                return this.services.session.addCommand('leaveChannel', {\n                  channelSid: this.sid\n                });\n\n              case 3:\n                return _context17.abrupt(\"return\", this);\n\n              case 4:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n\n      function leave() {\n        return _ref17.apply(this, arguments);\n      }\n\n      return leave;\n    }()\n    /**\n     * Remove a Member from the Channel.\n     * @param {String} member - identity of member to remove\n     * @returns {Promise<void|Error|SessionError>}\n     */\n\n  }, {\n    key: \"removeMember\",\n    value: function () {\n      var _ref18 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee18(member) {\n        return _regenerator2.default.wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                if (!(!member || typeof member !== 'string' && !(member instanceof member_1.Member))) {\n                  _context18.next = 2;\n                  break;\n                }\n\n                throw new Error('Channel.removeMember requires a <String|Member>member parameter.');\n\n              case 2:\n                if (!(member instanceof member_1.Member)) {\n                  _context18.next = 7;\n                  break;\n                }\n\n                _context18.next = 5;\n                return this.membersEntity.removeBySid(member.sid);\n\n              case 5:\n                _context18.next = 9;\n                break;\n\n              case 7:\n                _context18.next = 9;\n                return this.membersEntity.removeByIdentity(member);\n\n              case 9:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n\n      function removeMember(_x9) {\n        return _ref18.apply(this, arguments);\n      }\n\n      return removeMember;\n    }()\n    /**\n     * Send a Message in the Channel.\n     * @param {String | FormData | Channel#SendMediaOptions} message - The message body for text message,\n     * FormData or MediaOptions for media content. Sending FormData supported only with browser engine\n     * @param {Object} messageAttributes - attributes for the message\n     * @returns {Promise<number|Error|SessionError>} new Message's index in the Channel's messages list\n     */\n\n  }, {\n    key: \"sendMessage\",\n    value: function () {\n      var _ref19 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee19(message, messageAttributes) {\n        var response, _response;\n\n        return _regenerator2.default.wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                if (!(typeof message === 'undefined')) {\n                  _context19.next = 2;\n                  break;\n                }\n\n                throw new Error('Message is required parameter');\n\n              case 2:\n                if (!(typeof message === 'string' || message === null)) {\n                  _context19.next = 9;\n                  break;\n                }\n\n                _context19.next = 5;\n                return this.messagesEntity.send(message, messageAttributes);\n\n              case 5:\n                response = _context19.sent;\n                return _context19.abrupt(\"return\", util_1.parseToNumber(response.messageId));\n\n              case 9:\n                _context19.next = 11;\n                return this.messagesEntity.sendMedia(message, messageAttributes);\n\n              case 11:\n                _response = _context19.sent;\n                return _context19.abrupt(\"return\", util_1.parseToNumber(_response.messageId));\n\n              case 13:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this);\n      }));\n\n      function sendMessage(_x10, _x11) {\n        return _ref19.apply(this, arguments);\n      }\n\n      return sendMessage;\n    }()\n    /**\n     * Set last consumed Channel's Message index to last known Message's index in this Channel.\n     * @returns {Promise<number|SessionError>} resulting unread messages count in the channel\n     */\n\n  }, {\n    key: \"setAllMessagesConsumed\",\n    value: function () {\n      var _ref20 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee20() {\n        var messagesPage;\n        return _regenerator2.default.wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                _context20.next = 2;\n                return this._subscribeStreams();\n\n              case 2:\n                _context20.next = 4;\n                return this.getMessages(1);\n\n              case 4:\n                messagesPage = _context20.sent;\n\n                if (!(messagesPage.items.length > 0)) {\n                  _context20.next = 7;\n                  break;\n                }\n\n                return _context20.abrupt(\"return\", this.advanceLastConsumedMessageIndex(messagesPage.items[0].index));\n\n              case 7:\n                return _context20.abrupt(\"return\", _promise2.default.resolve(0));\n\n              case 8:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this);\n      }));\n\n      function setAllMessagesConsumed() {\n        return _ref20.apply(this, arguments);\n      }\n\n      return setAllMessagesConsumed;\n    }()\n    /**\n     * Set all messages in the channel unread.\n     * @returns {Promise<number|SessionError>} resulting unread messages count in the channel\n     */\n\n  }, {\n    key: \"setNoMessagesConsumed\",\n    value: function () {\n      var _ref21 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee21() {\n        return _regenerator2.default.wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                _context21.next = 2;\n                return this._subscribeStreams();\n\n              case 2:\n                return _context21.abrupt(\"return\", this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid, null));\n\n              case 3:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n\n      function setNoMessagesConsumed() {\n        return _ref21.apply(this, arguments);\n      }\n\n      return setNoMessagesConsumed;\n    }()\n    /**\n     * Set User Notification level for this channel.\n     * @param {Channel#NotificationLevel} notificationLevel - The new user notification level\n     * @returns {Promise<void|Error|SessionError>}\n     */\n\n  }, {\n    key: \"setUserNotificationLevel\",\n    value: function () {\n      var _ref22 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee22(notificationLevel) {\n        return _regenerator2.default.wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                if (notificationLevel) {\n                  _context22.next = 2;\n                  break;\n                }\n\n                throw new Error('notificationLevel can\\'t be null');\n\n              case 2:\n                _context22.next = 4;\n                return this.services.session.addCommand('editNotificationLevel', {\n                  channelSid: this.sid,\n                  notificationLevel: notificationLevel\n                });\n\n              case 4:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22, this);\n      }));\n\n      function setUserNotificationLevel(_x12) {\n        return _ref22.apply(this, arguments);\n      }\n\n      return setUserNotificationLevel;\n    }()\n    /**\n     * Send a notification to the server indicating that this Client is currently typing in this Channel.\n     * Typing ended notification is sent after a while automatically, but by calling again this method you ensure typing ended is not received.\n     * @returns {Promise<void|SessionError>}\n     */\n\n  }, {\n    key: \"typing\",\n    value: function typing() {\n      return this.services.typingIndicator.send(this.sid);\n    }\n    /**\n     * Update the Channel's attributes.\n     * @param {Object} attributes - The new attributes object\n     * @returns {Promise<Channel|Error|SessionError>}\n     */\n\n  }, {\n    key: \"updateAttributes\",\n    value: function () {\n      var _ref23 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee23(attributes) {\n        return _regenerator2.default.wrap(function _callee23$(_context23) {\n          while (1) {\n            switch (_context23.prev = _context23.next) {\n              case 0:\n                if (!(typeof attributes === 'undefined')) {\n                  _context23.next = 4;\n                  break;\n                }\n\n                throw new Error('Attributes is required parameter');\n\n              case 4:\n                if (!(attributes === null)) {\n                  _context23.next = 8;\n                  break;\n                }\n\n                throw new Error('Attributes can\\'t be null');\n\n              case 8:\n                if (!(attributes.constructor !== Object)) {\n                  _context23.next = 10;\n                  break;\n                }\n\n                throw new Error('Attributes must be a valid JSON object.');\n\n              case 10:\n                _context23.next = 12;\n                return this.services.session.addCommand('editAttributes', {\n                  channelSid: this.sid,\n                  attributes: (0, _stringify2.default)(attributes)\n                });\n\n              case 12:\n                return _context23.abrupt(\"return\", this);\n\n              case 13:\n              case \"end\":\n                return _context23.stop();\n            }\n          }\n        }, _callee23, this);\n      }));\n\n      function updateAttributes(_x13) {\n        return _ref23.apply(this, arguments);\n      }\n\n      return updateAttributes;\n    }()\n    /**\n     * Update the Channel's friendlyName.\n     * @param {String} name - The new Channel friendlyName\n     * @returns {Promise<Channel|SessionError>}\n     */\n\n  }, {\n    key: \"updateFriendlyName\",\n    value: function () {\n      var _ref24 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee24(name) {\n        return _regenerator2.default.wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                if (!(this.channelState.friendlyName !== name)) {\n                  _context24.next = 3;\n                  break;\n                }\n\n                _context24.next = 3;\n                return this.services.session.addCommand('editFriendlyName', {\n                  channelSid: this.sid,\n                  friendlyName: name\n                });\n\n              case 3:\n                return _context24.abrupt(\"return\", this);\n\n              case 4:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24, this);\n      }));\n\n      function updateFriendlyName(_x14) {\n        return _ref24.apply(this, arguments);\n      }\n\n      return updateFriendlyName;\n    }()\n    /**\n     * Set last consumed Channel's Message index to current consumption horizon.\n     * @param {Number|null} index - Message index to set as last read.\n     * If null provided, then the behavior is identical to {@link Channel#setNoMessagesConsumed}\n     * @returns {Promise<number|Error|SessionError>} resulting unread messages count in the channel\n     */\n\n  }, {\n    key: \"updateLastConsumedMessageIndex\",\n    value: function () {\n      var _ref25 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee25(index) {\n        return _regenerator2.default.wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                if ((0, _isInteger2.default)(index) || index === null) {\n                  _context25.next = 2;\n                  break;\n                }\n\n                throw new Error('Incorrect argument \"index\": integer number or null expected');\n\n              case 2:\n                _context25.next = 4;\n                return this._subscribeStreams();\n\n              case 4:\n                return _context25.abrupt(\"return\", this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid, index));\n\n              case 5:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25, this);\n      }));\n\n      function updateLastConsumedMessageIndex(_x15) {\n        return _ref25.apply(this, arguments);\n      }\n\n      return updateLastConsumedMessageIndex;\n    }()\n    /**\n     * Update the Channel's unique name.\n     * @param {String} uniqueName - The new Channel uniqueName\n     * @returns {Promise<Channel|SessionError>}\n     */\n\n  }, {\n    key: \"updateUniqueName\",\n    value: function () {\n      var _ref26 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee26(uniqueName) {\n        return _regenerator2.default.wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                if (!(this.channelState.uniqueName !== uniqueName)) {\n                  _context26.next = 4;\n                  break;\n                }\n\n                if (!uniqueName) {\n                  uniqueName = '';\n                }\n\n                _context26.next = 4;\n                return this.services.session.addCommand('editUniqueName', {\n                  channelSid: this.sid,\n                  uniqueName: uniqueName\n                });\n\n              case 4:\n                return _context26.abrupt(\"return\", this);\n\n              case 5:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26, this);\n      }));\n\n      function updateUniqueName(_x16) {\n        return _ref26.apply(this, arguments);\n      }\n\n      return updateUniqueName;\n    }()\n    /**\n     * Gets User Descriptors for this channel.\n     * @returns {Promise<Paginator<UserDescriptor>>}\n     */\n\n  }, {\n    key: \"getUserDescriptors\",\n    value: function () {\n      var _ref27 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee27() {\n        return _regenerator2.default.wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                return _context27.abrupt(\"return\", this.services.users.getChannelUserDescriptors(this.sid));\n\n              case 1:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27, this);\n      }));\n\n      function getUserDescriptors() {\n        return _ref27.apply(this, arguments);\n      }\n\n      return getUserDescriptors;\n    }()\n  }, {\n    key: \"status\",\n    get: function get() {\n      return this.channelState.status;\n    }\n  }, {\n    key: \"type\",\n    get: function get() {\n      return this.channelState.type;\n    }\n  }, {\n    key: \"uniqueName\",\n    get: function get() {\n      return this.channelState.uniqueName;\n    }\n  }, {\n    key: \"isPrivate\",\n    get: function get() {\n      return this.channelState.type === 'private';\n    }\n  }, {\n    key: \"friendlyName\",\n    get: function get() {\n      return this.channelState.friendlyName;\n    }\n  }, {\n    key: \"dateUpdated\",\n    get: function get() {\n      return this.channelState.dateUpdated;\n    }\n  }, {\n    key: \"dateCreated\",\n    get: function get() {\n      return this.channelState.dateCreated;\n    }\n  }, {\n    key: \"createdBy\",\n    get: function get() {\n      return this.channelState.createdBy;\n    }\n  }, {\n    key: \"attributes\",\n    get: function get() {\n      return this.channelState.attributes;\n    }\n  }, {\n    key: \"lastConsumedMessageIndex\",\n    get: function get() {\n      return this.channelState.lastConsumedMessageIndex;\n    }\n  }, {\n    key: \"lastMessage\",\n    get: function get() {\n      return this.channelState.lastMessage;\n    }\n  }, {\n    key: \"notificationLevel\",\n    get: function get() {\n      return this.channelState.notificationLevel;\n    }\n  }, {\n    key: \"state\",\n    get: function get() {\n      return this.channelState.state;\n    }\n  }], [{\n    key: \"preprocessUpdate\",\n    value: function preprocessUpdate(update, channelSid) {\n      try {\n        if (typeof update.attributes === 'string') {\n          update.attributes = JSON.parse(update.attributes);\n        } else if (update.attributes) {\n          (0, _stringify2.default)(update.attributes);\n        }\n      } catch (e) {\n        log.warn('Retrieved malformed attributes from the server for channel: ' + channelSid);\n        update.attributes = {};\n      }\n\n      try {\n        if (update.dateCreated) {\n          update.dateCreated = new Date(update.dateCreated);\n        }\n      } catch (e) {\n        log.warn('Retrieved malformed dateCreated from the server for channel: ' + channelSid);\n        delete update.dateCreated;\n      }\n\n      try {\n        if (update.dateUpdated) {\n          update.dateUpdated = new Date(update.dateUpdated);\n        }\n      } catch (e) {\n        log.warn('Retrieved malformed dateUpdated from the server for channel: ' + channelSid);\n        delete update.dateUpdated;\n      }\n\n      try {\n        if (update.lastMessage && update.lastMessage.timestamp) {\n          update.lastMessage.timestamp = new Date(update.lastMessage.timestamp);\n        }\n      } catch (e) {\n        log.warn('Retrieved malformed lastMessage.timestamp from the server for channel: ' + channelSid);\n        delete update.lastMessage.timestamp;\n      }\n    }\n  }]);\n  return Channel;\n}(events_1.EventEmitter);\n\nexports.Channel = Channel;\n/**\n * Fired when a Member has joined the Channel.\n * @event Channel#memberJoined\n * @type {Member}\n */\n\n/**\n * Fired when a Member has left the Channel.\n * @event Channel#memberLeft\n * @type {Member}\n */\n\n/**\n * Fired when a Member's fields has been updated.\n * @event Channel#memberUpdated\n * @type {Object}\n * @property {Member} member - Updated Member\n * @property {Member#UpdateReason[]} updateReasons - Array of Member's updated event reasons\n */\n\n/**\n * Fired when a new Message has been added to the Channel.\n * @event Channel#messageAdded\n * @type {Message}\n */\n\n/**\n * Fired when Message is removed from Channel's message list.\n * @event Channel#messageRemoved\n * @type {Message}\n */\n\n/**\n * Fired when an existing Message's fields are updated with new values.\n * @event Channel#messageUpdated\n * @type {Object}\n * @property {Message} message - Updated Message\n * @property {Message#UpdateReason[]} updateReasons - Array of Message's updated event reasons\n */\n\n/**\n * Fired when a Member has stopped typing.\n * @event Channel#typingEnded\n * @type {Member}\n */\n\n/**\n * Fired when a Member has started typing.\n * @event Channel#typingStarted\n * @type {Member}\n */\n\n/**\n * Fired when a Channel's attributes or metadata have been updated.\n * During Channel's {@link Client.create | creation and initialization} this event might be fired multiple times\n * for same joined or created Channel as new data is arriving from different sources.\n * @event Channel#updated\n * @type {Object}\n * @property {Channel} channel - Updated Channel\n * @property {Channel#UpdateReason[]} updateReasons - Array of Channel's updated event reasons\n */\n\n/**\n * Fired when the Channel was destroyed or currently logged in User has left private Channel\n * @event Channel#removed\n * @type {Channel}\n */","map":{"version":3,"sources":["/root/twilio-phone-client/node_modules/twilio-chat/browser/channel.js"],"names":["_keys","require","_keys2","_interopRequireDefault","_getIterator2","_getIterator3","_toConsumableArray2","_toConsumableArray3","_set","_set2","_regenerator","_regenerator2","_promise","_promise2","_asyncToGenerator2","_asyncToGenerator3","_map","_map2","_stringify","_stringify2","_isInteger","_isInteger2","_getPrototypeOf","_getPrototypeOf2","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","obj","__esModule","default","Object","defineProperty","exports","value","events_1","logger_1","members_1","member_1","messages_1","util_1","log","Logger","scope","fieldMappings","lastMessage","attributes","createdBy","dateCreated","dateUpdated","friendlyName","lastConsumedMessageIndex","notificationLevel","sid","status","type","uniqueName","state","parseTime","timeString","Date","e","filterStatus","Channel","_events_1$EventEmitte","services","descriptor","_this","__proto__","call","Error","entityName","channel","channelState","members","membersEntity","Members","on","emit","bind","args","messagesEntity","Messages","message","_onMessageAdded","key","_subscribe","_this2","entityPromise","syncClient","document","id","mode","then","entity","_update","catch","err","connectionState","error","debug","_ref","mark","_callee","messagesObjectName","rosterObjectName","wrap","_callee$","_context","prev","next","trace","messages","roster","all","subscribe","t0","stop","_subscribeStreams","apply","arguments","_ref2","_callee2","_callee2$","_context2","isPrivate","close","abrupt","unsubscribe","_unsubscribe","_setStatus","source","_this3","statusSource","_statusSource","update","_a","_b","_c","_d","_e","preprocessUpdate","updateReasons","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","_step","done","localKey","add","isDeepEqual","index","timestamp","getTime","isDate","keysMatchAsDates","keysMatchAsNonDates","return","size","concat","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","values","_step2","member","identity","author","_endTyping","_ref3","_callee3","_callee3$","_context3","_x","_ref4","_callee4","_callee4$","_context4","consumptionHorizon","advanceLastConsumedMessageIndexForChannel","advanceLastConsumedMessageIndex","_x2","_ref5","_callee5","_callee5$","_context5","session","addCommand","channelSid","decline","_ref6","_callee6","_callee6$","_context6","_delete","_ref7","_callee7","_callee7$","_context7","getAttributes","_ref8","_callee8","pageSize","anchor","direction","_callee8$","_context8","getMessages","_x3","_x4","_x5","_ref9","_callee9","_callee9$","_context9","getMembers","_ref10","_callee10","links","url","response","_callee10$","_context10","getSessionLinks","sent","UriBuilder","publicChannelsUrl","path","build","network","get","body","members_count","getMembersCount","_ref11","_callee11","memberSid","_callee11$","_context11","getMemberBySid","_x6","_ref12","_callee12","_callee12$","_context12","getMemberByIdentity","_x7","_ref13","_callee13","_callee13$","_context13","messages_count","getMessagesCount","_ref14","_callee14","_callee14$","_context14","myChannelsUrl","arg","channels","length","channel_sid","unread_messages_count","getUnconsumedMessagesCount","_ref15","_callee15","_callee15$","_context15","invite","_x8","_ref16","_callee16","_callee16$","_context16","join","_ref17","_callee17","_callee17$","_context17","leave","_ref18","_callee18","_callee18$","_context18","Member","removeBySid","removeByIdentity","removeMember","_x9","_ref19","_callee19","messageAttributes","_response","_callee19$","_context19","send","parseToNumber","messageId","sendMedia","sendMessage","_x10","_x11","_ref20","_callee20","messagesPage","_callee20$","_context20","items","resolve","setAllMessagesConsumed","_ref21","_callee21","_callee21$","_context21","updateLastConsumedMessageIndexForChannel","setNoMessagesConsumed","_ref22","_callee22","_callee22$","_context22","setUserNotificationLevel","_x12","typing","typingIndicator","_ref23","_callee23","_callee23$","_context23","constructor","updateAttributes","_x13","_ref24","_callee24","name","_callee24$","_context24","updateFriendlyName","_x14","_ref25","_callee25","_callee25$","_context25","updateLastConsumedMessageIndex","_x15","_ref26","_callee26","_callee26$","_context26","updateUniqueName","_x16","_ref27","_callee27","_callee27$","_context27","users","getChannelUserDescriptors","getUserDescriptors","JSON","parse","warn","EventEmitter"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _keys = require(\"babel-runtime/core-js/object/keys\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _toConsumableArray2 = require(\"babel-runtime/helpers/toConsumableArray\");\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _set = require(\"babel-runtime/core-js/set\");\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _promise = require(\"babel-runtime/core-js/promise\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _map = require(\"babel-runtime/core-js/map\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _stringify = require(\"babel-runtime/core-js/json/stringify\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _isInteger = require(\"babel-runtime/core-js/number/is-integer\");\n\nvar _isInteger2 = _interopRequireDefault(_isInteger);\n\nvar _getPrototypeOf = require(\"babel-runtime/core-js/object/get-prototype-of\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar events_1 = require(\"events\");\nvar logger_1 = require(\"./logger\");\nvar members_1 = require(\"./data/members\");\nvar member_1 = require(\"./member\");\nvar messages_1 = require(\"./data/messages\");\nvar util_1 = require(\"./util\");\nvar log = logger_1.Logger.scope('Channel');\nvar fieldMappings = {\n    lastMessage: 'lastMessage',\n    attributes: 'attributes',\n    createdBy: 'createdBy',\n    dateCreated: 'dateCreated',\n    dateUpdated: 'dateUpdated',\n    friendlyName: 'friendlyName',\n    lastConsumedMessageIndex: 'lastConsumedMessageIndex',\n    notificationLevel: 'notificationLevel',\n    sid: 'sid',\n    status: 'status',\n    type: 'type',\n    uniqueName: 'uniqueName',\n    state: 'state'\n};\nfunction parseTime(timeString) {\n    try {\n        return new Date(timeString);\n    } catch (e) {\n        return null;\n    }\n}\nfunction filterStatus(status) {\n    switch (status) {\n        case 'notParticipating':\n            return 'known';\n        default:\n            return status;\n    }\n}\nexports.filterStatus = filterStatus;\n/**\n * @classdesc A Channel represents a remote channel of communication between multiple Programmable Chat Clients\n * @property {Object} attributes - The Channel's custom attributes\n * @property {String} createdBy - The identity of the User that created this Channel\n * @property {Date} dateCreated - The Date this Channel was created\n * @property {Date} dateUpdated - The Date this Channel was last updated\n * @property {String} friendlyName - The Channel's name\n * @property {Boolean} isPrivate - Whether the channel is private (as opposed to public)\n * @property {Number} lastConsumedMessageIndex - Index of the last Message the User has consumed in this Channel\n * @property {Channel#LastMessage} lastMessage - Last Message sent to this Channel\n * @property {Channel#NotificationLevel} notificationLevel - User Notification level for this Channel\n * @property {String} sid - The Channel's unique system identifier\n * @property {Channel#State} state - The Channel's state\n * @property {Channel#Status} status - The Channel's status\n * @property {Channel#Type} type - The Channel's type\n * @property {String} uniqueName - The Channel's unique name (tag)\n * @fires Channel#memberJoined\n * @fires Channel#memberLeft\n * @fires Channel#memberUpdated\n * @fires Channel#messageAdded\n * @fires Channel#messageRemoved\n * @fires Channel#messageUpdated\n * @fires Channel#typingEnded\n * @fires Channel#typingStarted\n * @fires Channel#updated\n * @fires Channel#removed\n */\n\nvar Channel = function (_events_1$EventEmitte) {\n    (0, _inherits3.default)(Channel, _events_1$EventEmitte);\n\n    /**\n     * These options can be passed to {@link Channel#sendMessage}.\n     * @typedef {Object} Channel#SendMediaOptions\n     * @property {String} contentType - content type of media\n     * @property {String | Buffer} media - content to post\n     */\n    /**\n     * The update reason for <code>updated</code> event emitted on Channel\n     * @typedef {('attributes' | 'createdBy' | 'dateCreated' | 'dateUpdated' |\n      'friendlyName' | 'lastConsumedMessageIndex' | 'state' | 'status' | 'uniqueName' | 'lastMessage' |\n      'notificationLevel' )} Channel#UpdateReason\n     */\n    /**\n     * The status of the Channel, relative to the Client: whether the Channel\n     * is <code>known</code> to local Client, Client is <code>invited</code> to or\n     * is <code>joined</code> to this Channel\n     * @typedef {('unknown' | 'known' | 'invited' | 'joined')} Channel#Status\n     */\n    /**\n     * The type of Channel (<code>public</code> or <code>private</code>).\n     * @typedef {('public' | 'private')} Channel#Type\n     */\n    /**\n     * The User's Notification level for Channel, determines whether the currently logged-in User will receive\n     * pushes for events in this Channel. Can be either <code>muted</code> or <code>default</code>,\n     * where <code>default</code> defers to global Service push configuration.\n     * @typedef {('default' | 'muted')} Channel#NotificationLevel\n     */\n    /**\n     * The Channel's state. Set to undefined if the channel is not a conversation.\n     * @typedef {Object | undefined} Channel#State\n     * @property {('active' | 'inactive' | 'closed')} current - the current state\n     * @property {Date} dateUpdated - date at which the latest channel state update happened\n     */\n    function Channel(services, descriptor, sid) {\n        (0, _classCallCheck3.default)(this, Channel);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (Channel.__proto__ || (0, _getPrototypeOf2.default)(Channel)).call(this));\n\n        var attributes = descriptor.attributes || {};\n        var createdBy = descriptor.createdBy;\n        var dateCreated = parseTime(descriptor.dateCreated);\n        var dateUpdated = parseTime(descriptor.dateUpdated);\n        var friendlyName = descriptor.friendlyName || null;\n        var lastConsumedMessageIndex = (0, _isInteger2.default)(descriptor.lastConsumedMessageIndex) ? descriptor.lastConsumedMessageIndex : null;\n        var uniqueName = descriptor.uniqueName || null;\n        try {\n            (0, _stringify2.default)(attributes);\n        } catch (e) {\n            throw new Error('Attributes must be a valid JSON object.');\n        }\n        _this.services = services;\n        _this.sid = sid;\n        _this.entityName = descriptor.channel;\n        _this.channelState = {\n            uniqueName: uniqueName,\n            status: 'known',\n            type: descriptor.type,\n            attributes: attributes,\n            createdBy: createdBy,\n            dateCreated: dateCreated,\n            dateUpdated: dateUpdated,\n            friendlyName: friendlyName,\n            lastConsumedMessageIndex: lastConsumedMessageIndex\n        };\n        if (descriptor.notificationLevel) {\n            _this.channelState.notificationLevel = descriptor.notificationLevel;\n        }\n        _this.members = new _map2.default();\n        _this.membersEntity = new members_1.Members(_this, _this.services, _this.members);\n        _this.membersEntity.on('memberJoined', _this.emit.bind(_this, 'memberJoined'));\n        _this.membersEntity.on('memberLeft', _this.emit.bind(_this, 'memberLeft'));\n        _this.membersEntity.on('memberUpdated', function (args) {\n            return _this.emit('memberUpdated', args);\n        });\n        _this.messagesEntity = new messages_1.Messages(_this, services);\n        _this.messagesEntity.on('messageAdded', function (message) {\n            return _this._onMessageAdded(message);\n        });\n        _this.messagesEntity.on('messageUpdated', function (args) {\n            return _this.emit('messageUpdated', args);\n        });\n        _this.messagesEntity.on('messageRemoved', _this.emit.bind(_this, 'messageRemoved'));\n        return _this;\n    }\n\n    (0, _createClass3.default)(Channel, [{\n        key: \"_subscribe\",\n\n        /**\n         * The Channel's last message's information.\n         * @typedef {Object} Channel#LastMessage\n         * @property {Number} index - Message's index\n         * @property {Date} timestamp - Message's creation timestamp\n         */\n        /**\n         * Load and Subscribe to this Channel and do not subscribe to its Members and Messages.\n         * This or _subscribeStreams will need to be called before any events on Channel will fire.\n         * @returns {Promise}\n         * @private\n         */\n        value: function _subscribe() {\n            var _this2 = this;\n\n            if (this.entityPromise) {\n                return this.entityPromise;\n            }\n            return this.entityPromise = this.entityPromise || this.services.syncClient.document({ id: this.entityName, mode: 'open_existing' }).then(function (entity) {\n                _this2.entity = entity;\n                _this2.entity.on('updated', function (args) {\n                    _this2._update(args.value);\n                });\n                _this2.entity.on('removed', function () {\n                    return _this2.emit('removed', _this2);\n                });\n                _this2._update(_this2.entity.value);\n                return entity;\n            }).catch(function (err) {\n                _this2.entity = null;\n                _this2.entityPromise = null;\n                if (_this2.services.syncClient.connectionState != 'disconnected') {\n                    log.error('Failed to get channel object', err);\n                }\n                log.debug('ERROR: Failed to get channel object', err);\n                throw err;\n            });\n        }\n        /**\n         * Load the attributes of this Channel and instantiate its Members and Messages.\n         * This or _subscribe will need to be called before any events on Channel will fire.\n         * This will need to be called before any events on Members or Messages will fire\n         * @returns {Promise}\n         * @private\n         */\n\n    }, {\n        key: \"_subscribeStreams\",\n        value: function () {\n            var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n                var messagesObjectName, rosterObjectName;\n                return _regenerator2.default.wrap(function _callee$(_context) {\n                    while (1) {\n                        switch (_context.prev = _context.next) {\n                            case 0:\n                                _context.prev = 0;\n                                _context.next = 3;\n                                return this._subscribe();\n\n                            case 3:\n                                log.trace('_subscribeStreams, this.entity.value=', this.entity.value);\n                                messagesObjectName = this.entity.value.messages;\n                                rosterObjectName = this.entity.value.roster;\n                                _context.next = 8;\n                                return _promise2.default.all([this.messagesEntity.subscribe(messagesObjectName), this.membersEntity.subscribe(rosterObjectName)]);\n\n                            case 8:\n                                _context.next = 15;\n                                break;\n\n                            case 10:\n                                _context.prev = 10;\n                                _context.t0 = _context[\"catch\"](0);\n\n                                if (this.services.syncClient.connectionState !== 'disconnected') {\n                                    log.error('Failed to subscribe on channel objects', this.sid, _context.t0);\n                                }\n                                log.debug('ERROR: Failed to subscribe on channel objects', this.sid, _context.t0);\n                                throw _context.t0;\n\n                            case 15:\n                            case \"end\":\n                                return _context.stop();\n                        }\n                    }\n                }, _callee, this, [[0, 10]]);\n            }));\n\n            function _subscribeStreams() {\n                return _ref.apply(this, arguments);\n            }\n\n            return _subscribeStreams;\n        }()\n        /**\n         * Stop listening for and firing events on this Channel.\n         * @returns {Promise}\n         * @private\n         */\n\n    }, {\n        key: \"_unsubscribe\",\n        value: function () {\n            var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n                return _regenerator2.default.wrap(function _callee2$(_context2) {\n                    while (1) {\n                        switch (_context2.prev = _context2.next) {\n                            case 0:\n                                if (!(this.isPrivate && this.entity)) {\n                                    _context2.next = 5;\n                                    break;\n                                }\n\n                                _context2.next = 3;\n                                return this.entity.close();\n\n                            case 3:\n                                this.entity = null;\n                                this.entityPromise = null;\n\n                            case 5:\n                                return _context2.abrupt(\"return\", _promise2.default.all([this.membersEntity.unsubscribe(), this.messagesEntity.unsubscribe()]));\n\n                            case 6:\n                            case \"end\":\n                                return _context2.stop();\n                        }\n                    }\n                }, _callee2, this);\n            }));\n\n            function _unsubscribe() {\n                return _ref2.apply(this, arguments);\n            }\n\n            return _unsubscribe;\n        }()\n        /**\n         * Set channel status\n         * @private\n         */\n\n    }, {\n        key: \"_setStatus\",\n        value: function _setStatus(status, source) {\n            var _this3 = this;\n\n            this.statusSource = source;\n            if (this.channelState.status === status) {\n                return;\n            }\n            this.channelState.status = status;\n            if (status === 'joined') {\n                this._subscribeStreams().catch(function (err) {\n                    log.debug('ERROR while setting channel status ' + status, err);\n                    if (_this3.services.syncClient.connectionState !== 'disconnected') {\n                        throw err;\n                    }\n                });\n            } else if (status === 'invited') {\n                this._subscribe().catch(function (err) {\n                    log.debug('ERROR while setting channel status ' + status, err);\n                    if (_this3.services.syncClient.connectionState !== 'disconnected') {\n                        throw err;\n                    }\n                });\n            } else if (this.entityPromise) {\n                this._unsubscribe().catch(function (err) {\n                    log.debug('ERROR while setting channel status ' + status, err);\n                    if (_this3.services.syncClient.connectionState !== 'disconnected') {\n                        throw err;\n                    }\n                });\n            }\n        }\n        /**\n         * If channel's status update source\n         * @private\n         * @return {Channels.DataSource}\n         */\n\n    }, {\n        key: \"_statusSource\",\n        value: function _statusSource() {\n            return this.statusSource;\n        }\n    }, {\n        key: \"_update\",\n\n        /**\n         * Updates local channel object with new values\n         * @private\n         */\n        value: function _update(update) {\n            var _a, _b, _c, _d, _e;\n            log.trace('_update', update);\n            Channel.preprocessUpdate(update, this.sid);\n            var updateReasons = new _set2.default();\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = (0, _getIterator3.default)((0, _keys2.default)(update)), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var key = _step.value;\n\n                    var localKey = fieldMappings[key];\n                    if (!localKey) {\n                        continue;\n                    }\n                    switch (localKey) {\n                        case fieldMappings.status:\n                            if (!update.status || update.status === 'unknown' || this.channelState.status === filterStatus(update.status)) {\n                                break;\n                            }\n                            this.channelState.status = filterStatus(update.status);\n                            updateReasons.add(localKey);\n                            break;\n                        case fieldMappings.attributes:\n                            if (util_1.isDeepEqual(this.channelState.attributes, update.attributes)) {\n                                break;\n                            }\n                            this.channelState.attributes = update.attributes;\n                            updateReasons.add(localKey);\n                            break;\n                        case fieldMappings.lastConsumedMessageIndex:\n                            if (update.lastConsumedMessageIndex === undefined || update.lastConsumedMessageIndex === this.channelState.lastConsumedMessageIndex) {\n                                break;\n                            }\n                            this.channelState.lastConsumedMessageIndex = update.lastConsumedMessageIndex;\n                            updateReasons.add(localKey);\n                            break;\n                        case fieldMappings.lastMessage:\n                            if (this.channelState.lastMessage && !update.lastMessage) {\n                                delete this.channelState.lastMessage;\n                                updateReasons.add(localKey);\n                                break;\n                            }\n                            this.channelState.lastMessage = this.channelState.lastMessage || {};\n                            if (((_a = update.lastMessage) === null || _a === void 0 ? void 0 : _a.index) !== undefined && update.lastMessage.index !== this.channelState.lastMessage.index) {\n                                this.channelState.lastMessage.index = update.lastMessage.index;\n                                updateReasons.add(localKey);\n                            }\n                            if (((_b = update.lastMessage) === null || _b === void 0 ? void 0 : _b.timestamp) !== undefined && ((_d = (_c = this.channelState.lastMessage) === null || _c === void 0 ? void 0 : _c.timestamp) === null || _d === void 0 ? void 0 : _d.getTime()) !== update.lastMessage.timestamp.getTime()) {\n                                this.channelState.lastMessage.timestamp = update.lastMessage.timestamp;\n                                updateReasons.add(localKey);\n                            }\n                            if (util_1.isDeepEqual(this.channelState.lastMessage, {})) {\n                                delete this.channelState.lastMessage;\n                            }\n                            break;\n                        case fieldMappings.state:\n                            var state = update.state || undefined;\n                            if (state !== undefined) {\n                                state.dateUpdated = new Date(state.dateUpdated);\n                            }\n                            if (util_1.isDeepEqual(this.channelState.state, state)) {\n                                break;\n                            }\n                            this.channelState.state = state;\n                            updateReasons.add(localKey);\n                            break;\n                        default:\n                            var isDate = update[key] instanceof Date;\n                            var keysMatchAsDates = isDate && ((_e = this.channelState[localKey]) === null || _e === void 0 ? void 0 : _e.getTime()) === update[key].getTime();\n                            var keysMatchAsNonDates = !isDate && this[localKey] === update[key];\n                            if (keysMatchAsDates || keysMatchAsNonDates) {\n                                break;\n                            }\n                            this.channelState[localKey] = update[key];\n                            updateReasons.add(localKey);\n                    }\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n\n            if (updateReasons.size > 0) {\n                this.emit('updated', { channel: this, updateReasons: [].concat((0, _toConsumableArray3.default)(updateReasons)) });\n            }\n        }\n        /**\n         * @private\n         */\n\n    }, {\n        key: \"_onMessageAdded\",\n        value: function _onMessageAdded(message) {\n            var _iteratorNormalCompletion2 = true;\n            var _didIteratorError2 = false;\n            var _iteratorError2 = undefined;\n\n            try {\n                for (var _iterator2 = (0, _getIterator3.default)(this.members.values()), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                    var member = _step2.value;\n\n                    if (member.identity === message.author) {\n                        member._endTyping();\n                        break;\n                    }\n                }\n            } catch (err) {\n                _didIteratorError2 = true;\n                _iteratorError2 = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                        _iterator2.return();\n                    }\n                } finally {\n                    if (_didIteratorError2) {\n                        throw _iteratorError2;\n                    }\n                }\n            }\n\n            this.emit('messageAdded', message);\n        }\n        /**\n         * Add a participant to the Channel by its Identity.\n         * @param {String} identity - Identity of the Client to add\n         * @returns {Promise<void|Error|SessionError>}\n         */\n\n    }, {\n        key: \"add\",\n        value: function () {\n            var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(identity) {\n                return _regenerator2.default.wrap(function _callee3$(_context3) {\n                    while (1) {\n                        switch (_context3.prev = _context3.next) {\n                            case 0:\n                                if (!(!identity || typeof identity !== 'string')) {\n                                    _context3.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('Channel.add requires an <String>identity parameter');\n\n                            case 2:\n                                return _context3.abrupt(\"return\", this.membersEntity.add(identity));\n\n                            case 3:\n                            case \"end\":\n                                return _context3.stop();\n                        }\n                    }\n                }, _callee3, this);\n            }));\n\n            function add(_x) {\n                return _ref3.apply(this, arguments);\n            }\n\n            return add;\n        }()\n        /**\n         * Advance last consumed Channel's Message index to current consumption horizon.\n         * Rejects if User is not Member of Channel.\n         * Last consumed Message index is updated only if new index value is higher than previous.\n         * @param {Number} index - Message index to advance to as last read\n         * @returns {Promise<number|Error|SessionError>} resulting unread messages count in the channel\n         */\n\n    }, {\n        key: \"advanceLastConsumedMessageIndex\",\n        value: function () {\n            var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4(index) {\n                return _regenerator2.default.wrap(function _callee4$(_context4) {\n                    while (1) {\n                        switch (_context4.prev = _context4.next) {\n                            case 0:\n                                if ((0, _isInteger2.default)(index)) {\n                                    _context4.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('Channel.advanceLastConsumedMessageIndex requires an integral <Number>index parameter');\n\n                            case 2:\n                                _context4.next = 4;\n                                return this._subscribeStreams();\n\n                            case 4:\n                                return _context4.abrupt(\"return\", this.services.consumptionHorizon.advanceLastConsumedMessageIndexForChannel(this.sid, index, this.lastConsumedMessageIndex));\n\n                            case 5:\n                            case \"end\":\n                                return _context4.stop();\n                        }\n                    }\n                }, _callee4, this);\n            }));\n\n            function advanceLastConsumedMessageIndex(_x2) {\n                return _ref4.apply(this, arguments);\n            }\n\n            return advanceLastConsumedMessageIndex;\n        }()\n        /**\n         * Decline an invitation to the Channel and unsubscribe from its events.\n         * @returns {Promise<Channel|SessionError>}\n         */\n\n    }, {\n        key: \"decline\",\n        value: function () {\n            var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5() {\n                return _regenerator2.default.wrap(function _callee5$(_context5) {\n                    while (1) {\n                        switch (_context5.prev = _context5.next) {\n                            case 0:\n                                _context5.next = 2;\n                                return this.services.session.addCommand('declineInvitation', {\n                                    channelSid: this.sid\n                                });\n\n                            case 2:\n                                return _context5.abrupt(\"return\", this);\n\n                            case 3:\n                            case \"end\":\n                                return _context5.stop();\n                        }\n                    }\n                }, _callee5, this);\n            }));\n\n            function decline() {\n                return _ref5.apply(this, arguments);\n            }\n\n            return decline;\n        }()\n        /**\n         * Delete the Channel and unsubscribe from its events.\n         * @returns {Promise<Channel|SessionError>}\n         */\n\n    }, {\n        key: \"delete\",\n        value: function () {\n            var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6() {\n                return _regenerator2.default.wrap(function _callee6$(_context6) {\n                    while (1) {\n                        switch (_context6.prev = _context6.next) {\n                            case 0:\n                                _context6.next = 2;\n                                return this.services.session.addCommand('destroyChannel', {\n                                    channelSid: this.sid\n                                });\n\n                            case 2:\n                                return _context6.abrupt(\"return\", this);\n\n                            case 3:\n                            case \"end\":\n                                return _context6.stop();\n                        }\n                    }\n                }, _callee6, this);\n            }));\n\n            function _delete() {\n                return _ref6.apply(this, arguments);\n            }\n\n            return _delete;\n        }()\n        /**\n         * Get the custom attributes of this Channel.<br/>\n         *\n         * <i>NOTE: {@link Channel}'s <code>attributes</code> property will be empty for public channels until this function is called.</i>\n         * @returns {Promise<Object>}\n         */\n\n    }, {\n        key: \"getAttributes\",\n        value: function () {\n            var _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7() {\n                return _regenerator2.default.wrap(function _callee7$(_context7) {\n                    while (1) {\n                        switch (_context7.prev = _context7.next) {\n                            case 0:\n                                _context7.next = 2;\n                                return this._subscribe();\n\n                            case 2:\n                                return _context7.abrupt(\"return\", this.attributes);\n\n                            case 3:\n                            case \"end\":\n                                return _context7.stop();\n                        }\n                    }\n                }, _callee7, this);\n            }));\n\n            function getAttributes() {\n                return _ref7.apply(this, arguments);\n            }\n\n            return getAttributes;\n        }()\n        /**\n         * Returns messages from channel using paginator interface.\n         * @param {Number} [pageSize=30] Number of messages to return in single chunk\n         * @param {Number} [anchor] - Index of newest Message to fetch. From the end by default\n         * @param {String} [direction=backwards] - Query direction. By default it query backwards\n         *                                         from newer to older. 'forward' will query in opposite direction\n         * @returns {Promise<Paginator<Message>>} page of messages\n         */\n\n    }, {\n        key: \"getMessages\",\n        value: function () {\n            var _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee8(pageSize, anchor, direction) {\n                return _regenerator2.default.wrap(function _callee8$(_context8) {\n                    while (1) {\n                        switch (_context8.prev = _context8.next) {\n                            case 0:\n                                if (!(typeof anchor !== 'undefined' && !(0, _isInteger2.default)(anchor))) {\n                                    _context8.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('Anchor should be a valid message index');\n\n                            case 2:\n                                _context8.next = 4;\n                                return this._subscribeStreams();\n\n                            case 4:\n                                return _context8.abrupt(\"return\", this.messagesEntity.getMessages(pageSize, anchor, direction));\n\n                            case 5:\n                            case \"end\":\n                                return _context8.stop();\n                        }\n                    }\n                }, _callee8, this);\n            }));\n\n            function getMessages(_x3, _x4, _x5) {\n                return _ref8.apply(this, arguments);\n            }\n\n            return getMessages;\n        }()\n        /**\n         * Get a list of all Members joined to this Channel.\n         * @returns {Promise<Array<Member>>}\n         */\n\n    }, {\n        key: \"getMembers\",\n        value: function () {\n            var _ref9 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee9() {\n                return _regenerator2.default.wrap(function _callee9$(_context9) {\n                    while (1) {\n                        switch (_context9.prev = _context9.next) {\n                            case 0:\n                                _context9.next = 2;\n                                return this._subscribeStreams();\n\n                            case 2:\n                                return _context9.abrupt(\"return\", this.membersEntity.getMembers());\n\n                            case 3:\n                            case \"end\":\n                                return _context9.stop();\n                        }\n                    }\n                }, _callee9, this);\n            }));\n\n            function getMembers() {\n                return _ref9.apply(this, arguments);\n            }\n\n            return getMembers;\n        }()\n        /**\n         * Get channel members count.\n         * <br/>\n         * This method is semi-realtime. This means that this data will be eventually correct,\n         * but will also possibly be incorrect for a few seconds. The Chat system does not\n         * provide real time events for counter values changes.\n         * <br/>\n         * So this is quite useful for any UI badges, but is not recommended\n         * to build any core application logic based on these counters being accurate in real time.\n         * @returns {Promise<number|Error>}\n         */\n\n    }, {\n        key: \"getMembersCount\",\n        value: function () {\n            var _ref10 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee10() {\n                var links, url, response;\n                return _regenerator2.default.wrap(function _callee10$(_context10) {\n                    while (1) {\n                        switch (_context10.prev = _context10.next) {\n                            case 0:\n                                _context10.next = 2;\n                                return this.services.session.getSessionLinks();\n\n                            case 2:\n                                links = _context10.sent;\n                                url = new util_1.UriBuilder(links.publicChannelsUrl).path(this.sid).build();\n                                _context10.next = 6;\n                                return this.services.network.get(url);\n\n                            case 6:\n                                response = _context10.sent;\n                                return _context10.abrupt(\"return\", response.body.members_count);\n\n                            case 8:\n                            case \"end\":\n                                return _context10.stop();\n                        }\n                    }\n                }, _callee10, this);\n            }));\n\n            function getMembersCount() {\n                return _ref10.apply(this, arguments);\n            }\n\n            return getMembersCount;\n        }()\n        /**\n         * Get a Member by its SID.\n         * @param {String} memberSid - Member sid\n         * @returns {Promise<Member>}\n         */\n\n    }, {\n        key: \"getMemberBySid\",\n        value: function () {\n            var _ref11 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee11(memberSid) {\n                return _regenerator2.default.wrap(function _callee11$(_context11) {\n                    while (1) {\n                        switch (_context11.prev = _context11.next) {\n                            case 0:\n                                if (!(!memberSid || typeof memberSid !== 'string')) {\n                                    _context11.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('Channel.getMemberBySid requires a <String>memberSid parameter');\n\n                            case 2:\n                                return _context11.abrupt(\"return\", this.membersEntity.getMemberBySid(memberSid));\n\n                            case 3:\n                            case \"end\":\n                                return _context11.stop();\n                        }\n                    }\n                }, _callee11, this);\n            }));\n\n            function getMemberBySid(_x6) {\n                return _ref11.apply(this, arguments);\n            }\n\n            return getMemberBySid;\n        }()\n        /**\n         * Get a Member by its identity.\n         * @param {String} identity - Member identity\n         * @returns {Promise<Member>}\n         */\n\n    }, {\n        key: \"getMemberByIdentity\",\n        value: function () {\n            var _ref12 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee12(identity) {\n                return _regenerator2.default.wrap(function _callee12$(_context12) {\n                    while (1) {\n                        switch (_context12.prev = _context12.next) {\n                            case 0:\n                                if (!(!identity || typeof identity !== 'string')) {\n                                    _context12.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('Channel.getMemberByIdentity requires a <String>identity parameter');\n\n                            case 2:\n                                return _context12.abrupt(\"return\", this.membersEntity.getMemberByIdentity(identity));\n\n                            case 3:\n                            case \"end\":\n                                return _context12.stop();\n                        }\n                    }\n                }, _callee12, this);\n            }));\n\n            function getMemberByIdentity(_x7) {\n                return _ref12.apply(this, arguments);\n            }\n\n            return getMemberByIdentity;\n        }()\n        /**\n         * Get total message count in a channel.\n         * <br/>\n         * This method is semi-realtime. This means that this data will be eventually correct,\n         * but will also possibly be incorrect for a few seconds. The Chat system does not\n         * provide real time events for counter values changes.\n         * <br/>\n         * So this is quite useful for any UI badges, but is not recommended\n         * to build any core application logic based on these counters being accurate in real time.\n         * @returns {Promise<number|Error>}\n         */\n\n    }, {\n        key: \"getMessagesCount\",\n        value: function () {\n            var _ref13 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee13() {\n                var links, url, response;\n                return _regenerator2.default.wrap(function _callee13$(_context13) {\n                    while (1) {\n                        switch (_context13.prev = _context13.next) {\n                            case 0:\n                                _context13.next = 2;\n                                return this.services.session.getSessionLinks();\n\n                            case 2:\n                                links = _context13.sent;\n                                url = new util_1.UriBuilder(links.publicChannelsUrl).path(this.sid).build();\n                                _context13.next = 6;\n                                return this.services.network.get(url);\n\n                            case 6:\n                                response = _context13.sent;\n                                return _context13.abrupt(\"return\", response.body.messages_count);\n\n                            case 8:\n                            case \"end\":\n                                return _context13.stop();\n                        }\n                    }\n                }, _callee13, this);\n            }));\n\n            function getMessagesCount() {\n                return _ref13.apply(this, arguments);\n            }\n\n            return getMessagesCount;\n        }()\n        /**\n         * Get unconsumed messages count for User if he is Member of this Channel.\n         * Rejects if User is not Member of Channel.\n         * <br/>\n         * This method is semi-realtime. This means that this data will be eventually correct,\n         * but will also possibly be incorrect for a few seconds. The Chat system does not\n         * provide real time events for counter values changes.\n         * <br/>\n         * So this is quite useful for any “unread messages count” badges, but is not recommended\n         * to build any core application logic based on these counters being accurate in real time.\n         * @returns {Promise<number|Error>}\n         */\n\n    }, {\n        key: \"getUnconsumedMessagesCount\",\n        value: function () {\n            var _ref14 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee14() {\n                var links, url, response;\n                return _regenerator2.default.wrap(function _callee14$(_context14) {\n                    while (1) {\n                        switch (_context14.prev = _context14.next) {\n                            case 0:\n                                _context14.next = 2;\n                                return this.services.session.getSessionLinks();\n\n                            case 2:\n                                links = _context14.sent;\n                                url = new util_1.UriBuilder(links.myChannelsUrl).arg('ChannelSid', this.sid).build();\n                                _context14.next = 6;\n                                return this.services.network.get(url);\n\n                            case 6:\n                                response = _context14.sent;\n\n                                if (!(response.body.channels.length && response.body.channels[0].channel_sid == this.sid)) {\n                                    _context14.next = 11;\n                                    break;\n                                }\n\n                                if (!(typeof response.body.channels[0].unread_messages_count !== 'undefined' && response.body.channels[0].unread_messages_count != null)) {\n                                    _context14.next = 10;\n                                    break;\n                                }\n\n                                return _context14.abrupt(\"return\", response.body.channels[0].unread_messages_count);\n\n                            case 10:\n                                return _context14.abrupt(\"return\", null);\n\n                            case 11:\n                                throw new Error('Channel is not in user channels list');\n\n                            case 12:\n                            case \"end\":\n                                return _context14.stop();\n                        }\n                    }\n                }, _callee14, this);\n            }));\n\n            function getUnconsumedMessagesCount() {\n                return _ref14.apply(this, arguments);\n            }\n\n            return getUnconsumedMessagesCount;\n        }()\n        /**\n         * Invite a user to the Channel by their Identity.\n         * @param {String} identity - Identity of the user to invite\n         * @returns {Promise<void|Error|SessionError>}\n         */\n\n    }, {\n        key: \"invite\",\n        value: function () {\n            var _ref15 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee15(identity) {\n                return _regenerator2.default.wrap(function _callee15$(_context15) {\n                    while (1) {\n                        switch (_context15.prev = _context15.next) {\n                            case 0:\n                                if (!(typeof identity !== 'string' || !identity.length)) {\n                                    _context15.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('Channel.invite requires an <String>identity parameter');\n\n                            case 2:\n                                _context15.next = 4;\n                                return this.membersEntity.invite(identity);\n\n                            case 4:\n                            case \"end\":\n                                return _context15.stop();\n                        }\n                    }\n                }, _callee15, this);\n            }));\n\n            function invite(_x8) {\n                return _ref15.apply(this, arguments);\n            }\n\n            return invite;\n        }()\n        /**\n         * Join the Channel and subscribe to its events.\n         * @returns {Promise<Channel|SessionError>}\n         */\n\n    }, {\n        key: \"join\",\n        value: function () {\n            var _ref16 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee16() {\n                return _regenerator2.default.wrap(function _callee16$(_context16) {\n                    while (1) {\n                        switch (_context16.prev = _context16.next) {\n                            case 0:\n                                _context16.next = 2;\n                                return this.services.session.addCommand('joinChannelV2', { channelSid: this.sid });\n\n                            case 2:\n                                return _context16.abrupt(\"return\", this);\n\n                            case 3:\n                            case \"end\":\n                                return _context16.stop();\n                        }\n                    }\n                }, _callee16, this);\n            }));\n\n            function join() {\n                return _ref16.apply(this, arguments);\n            }\n\n            return join;\n        }()\n        /**\n         * Leave the Channel.\n         * @returns {Promise<Channel|SessionError>}\n         */\n\n    }, {\n        key: \"leave\",\n        value: function () {\n            var _ref17 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee17() {\n                return _regenerator2.default.wrap(function _callee17$(_context17) {\n                    while (1) {\n                        switch (_context17.prev = _context17.next) {\n                            case 0:\n                                if (!(this.channelState.status === 'joined')) {\n                                    _context17.next = 3;\n                                    break;\n                                }\n\n                                _context17.next = 3;\n                                return this.services.session.addCommand('leaveChannel', { channelSid: this.sid });\n\n                            case 3:\n                                return _context17.abrupt(\"return\", this);\n\n                            case 4:\n                            case \"end\":\n                                return _context17.stop();\n                        }\n                    }\n                }, _callee17, this);\n            }));\n\n            function leave() {\n                return _ref17.apply(this, arguments);\n            }\n\n            return leave;\n        }()\n        /**\n         * Remove a Member from the Channel.\n         * @param {String} member - identity of member to remove\n         * @returns {Promise<void|Error|SessionError>}\n         */\n\n    }, {\n        key: \"removeMember\",\n        value: function () {\n            var _ref18 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee18(member) {\n                return _regenerator2.default.wrap(function _callee18$(_context18) {\n                    while (1) {\n                        switch (_context18.prev = _context18.next) {\n                            case 0:\n                                if (!(!member || typeof member !== 'string' && !(member instanceof member_1.Member))) {\n                                    _context18.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('Channel.removeMember requires a <String|Member>member parameter.');\n\n                            case 2:\n                                if (!(member instanceof member_1.Member)) {\n                                    _context18.next = 7;\n                                    break;\n                                }\n\n                                _context18.next = 5;\n                                return this.membersEntity.removeBySid(member.sid);\n\n                            case 5:\n                                _context18.next = 9;\n                                break;\n\n                            case 7:\n                                _context18.next = 9;\n                                return this.membersEntity.removeByIdentity(member);\n\n                            case 9:\n                            case \"end\":\n                                return _context18.stop();\n                        }\n                    }\n                }, _callee18, this);\n            }));\n\n            function removeMember(_x9) {\n                return _ref18.apply(this, arguments);\n            }\n\n            return removeMember;\n        }()\n        /**\n         * Send a Message in the Channel.\n         * @param {String | FormData | Channel#SendMediaOptions} message - The message body for text message,\n         * FormData or MediaOptions for media content. Sending FormData supported only with browser engine\n         * @param {Object} messageAttributes - attributes for the message\n         * @returns {Promise<number|Error|SessionError>} new Message's index in the Channel's messages list\n         */\n\n    }, {\n        key: \"sendMessage\",\n        value: function () {\n            var _ref19 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee19(message, messageAttributes) {\n                var response, _response;\n\n                return _regenerator2.default.wrap(function _callee19$(_context19) {\n                    while (1) {\n                        switch (_context19.prev = _context19.next) {\n                            case 0:\n                                if (!(typeof message === 'undefined')) {\n                                    _context19.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('Message is required parameter');\n\n                            case 2:\n                                if (!(typeof message === 'string' || message === null)) {\n                                    _context19.next = 9;\n                                    break;\n                                }\n\n                                _context19.next = 5;\n                                return this.messagesEntity.send(message, messageAttributes);\n\n                            case 5:\n                                response = _context19.sent;\n                                return _context19.abrupt(\"return\", util_1.parseToNumber(response.messageId));\n\n                            case 9:\n                                _context19.next = 11;\n                                return this.messagesEntity.sendMedia(message, messageAttributes);\n\n                            case 11:\n                                _response = _context19.sent;\n                                return _context19.abrupt(\"return\", util_1.parseToNumber(_response.messageId));\n\n                            case 13:\n                            case \"end\":\n                                return _context19.stop();\n                        }\n                    }\n                }, _callee19, this);\n            }));\n\n            function sendMessage(_x10, _x11) {\n                return _ref19.apply(this, arguments);\n            }\n\n            return sendMessage;\n        }()\n        /**\n         * Set last consumed Channel's Message index to last known Message's index in this Channel.\n         * @returns {Promise<number|SessionError>} resulting unread messages count in the channel\n         */\n\n    }, {\n        key: \"setAllMessagesConsumed\",\n        value: function () {\n            var _ref20 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee20() {\n                var messagesPage;\n                return _regenerator2.default.wrap(function _callee20$(_context20) {\n                    while (1) {\n                        switch (_context20.prev = _context20.next) {\n                            case 0:\n                                _context20.next = 2;\n                                return this._subscribeStreams();\n\n                            case 2:\n                                _context20.next = 4;\n                                return this.getMessages(1);\n\n                            case 4:\n                                messagesPage = _context20.sent;\n\n                                if (!(messagesPage.items.length > 0)) {\n                                    _context20.next = 7;\n                                    break;\n                                }\n\n                                return _context20.abrupt(\"return\", this.advanceLastConsumedMessageIndex(messagesPage.items[0].index));\n\n                            case 7:\n                                return _context20.abrupt(\"return\", _promise2.default.resolve(0));\n\n                            case 8:\n                            case \"end\":\n                                return _context20.stop();\n                        }\n                    }\n                }, _callee20, this);\n            }));\n\n            function setAllMessagesConsumed() {\n                return _ref20.apply(this, arguments);\n            }\n\n            return setAllMessagesConsumed;\n        }()\n        /**\n         * Set all messages in the channel unread.\n         * @returns {Promise<number|SessionError>} resulting unread messages count in the channel\n         */\n\n    }, {\n        key: \"setNoMessagesConsumed\",\n        value: function () {\n            var _ref21 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee21() {\n                return _regenerator2.default.wrap(function _callee21$(_context21) {\n                    while (1) {\n                        switch (_context21.prev = _context21.next) {\n                            case 0:\n                                _context21.next = 2;\n                                return this._subscribeStreams();\n\n                            case 2:\n                                return _context21.abrupt(\"return\", this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid, null));\n\n                            case 3:\n                            case \"end\":\n                                return _context21.stop();\n                        }\n                    }\n                }, _callee21, this);\n            }));\n\n            function setNoMessagesConsumed() {\n                return _ref21.apply(this, arguments);\n            }\n\n            return setNoMessagesConsumed;\n        }()\n        /**\n         * Set User Notification level for this channel.\n         * @param {Channel#NotificationLevel} notificationLevel - The new user notification level\n         * @returns {Promise<void|Error|SessionError>}\n         */\n\n    }, {\n        key: \"setUserNotificationLevel\",\n        value: function () {\n            var _ref22 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee22(notificationLevel) {\n                return _regenerator2.default.wrap(function _callee22$(_context22) {\n                    while (1) {\n                        switch (_context22.prev = _context22.next) {\n                            case 0:\n                                if (notificationLevel) {\n                                    _context22.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('notificationLevel can\\'t be null');\n\n                            case 2:\n                                _context22.next = 4;\n                                return this.services.session.addCommand('editNotificationLevel', { channelSid: this.sid, notificationLevel: notificationLevel });\n\n                            case 4:\n                            case \"end\":\n                                return _context22.stop();\n                        }\n                    }\n                }, _callee22, this);\n            }));\n\n            function setUserNotificationLevel(_x12) {\n                return _ref22.apply(this, arguments);\n            }\n\n            return setUserNotificationLevel;\n        }()\n        /**\n         * Send a notification to the server indicating that this Client is currently typing in this Channel.\n         * Typing ended notification is sent after a while automatically, but by calling again this method you ensure typing ended is not received.\n         * @returns {Promise<void|SessionError>}\n         */\n\n    }, {\n        key: \"typing\",\n        value: function typing() {\n            return this.services.typingIndicator.send(this.sid);\n        }\n        /**\n         * Update the Channel's attributes.\n         * @param {Object} attributes - The new attributes object\n         * @returns {Promise<Channel|Error|SessionError>}\n         */\n\n    }, {\n        key: \"updateAttributes\",\n        value: function () {\n            var _ref23 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee23(attributes) {\n                return _regenerator2.default.wrap(function _callee23$(_context23) {\n                    while (1) {\n                        switch (_context23.prev = _context23.next) {\n                            case 0:\n                                if (!(typeof attributes === 'undefined')) {\n                                    _context23.next = 4;\n                                    break;\n                                }\n\n                                throw new Error('Attributes is required parameter');\n\n                            case 4:\n                                if (!(attributes === null)) {\n                                    _context23.next = 8;\n                                    break;\n                                }\n\n                                throw new Error('Attributes can\\'t be null');\n\n                            case 8:\n                                if (!(attributes.constructor !== Object)) {\n                                    _context23.next = 10;\n                                    break;\n                                }\n\n                                throw new Error('Attributes must be a valid JSON object.');\n\n                            case 10:\n                                _context23.next = 12;\n                                return this.services.session.addCommand('editAttributes', {\n                                    channelSid: this.sid,\n                                    attributes: (0, _stringify2.default)(attributes)\n                                });\n\n                            case 12:\n                                return _context23.abrupt(\"return\", this);\n\n                            case 13:\n                            case \"end\":\n                                return _context23.stop();\n                        }\n                    }\n                }, _callee23, this);\n            }));\n\n            function updateAttributes(_x13) {\n                return _ref23.apply(this, arguments);\n            }\n\n            return updateAttributes;\n        }()\n        /**\n         * Update the Channel's friendlyName.\n         * @param {String} name - The new Channel friendlyName\n         * @returns {Promise<Channel|SessionError>}\n         */\n\n    }, {\n        key: \"updateFriendlyName\",\n        value: function () {\n            var _ref24 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee24(name) {\n                return _regenerator2.default.wrap(function _callee24$(_context24) {\n                    while (1) {\n                        switch (_context24.prev = _context24.next) {\n                            case 0:\n                                if (!(this.channelState.friendlyName !== name)) {\n                                    _context24.next = 3;\n                                    break;\n                                }\n\n                                _context24.next = 3;\n                                return this.services.session.addCommand('editFriendlyName', {\n                                    channelSid: this.sid,\n                                    friendlyName: name\n                                });\n\n                            case 3:\n                                return _context24.abrupt(\"return\", this);\n\n                            case 4:\n                            case \"end\":\n                                return _context24.stop();\n                        }\n                    }\n                }, _callee24, this);\n            }));\n\n            function updateFriendlyName(_x14) {\n                return _ref24.apply(this, arguments);\n            }\n\n            return updateFriendlyName;\n        }()\n        /**\n         * Set last consumed Channel's Message index to current consumption horizon.\n         * @param {Number|null} index - Message index to set as last read.\n         * If null provided, then the behavior is identical to {@link Channel#setNoMessagesConsumed}\n         * @returns {Promise<number|Error|SessionError>} resulting unread messages count in the channel\n         */\n\n    }, {\n        key: \"updateLastConsumedMessageIndex\",\n        value: function () {\n            var _ref25 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee25(index) {\n                return _regenerator2.default.wrap(function _callee25$(_context25) {\n                    while (1) {\n                        switch (_context25.prev = _context25.next) {\n                            case 0:\n                                if ((0, _isInteger2.default)(index) || index === null) {\n                                    _context25.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('Incorrect argument \"index\": integer number or null expected');\n\n                            case 2:\n                                _context25.next = 4;\n                                return this._subscribeStreams();\n\n                            case 4:\n                                return _context25.abrupt(\"return\", this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid, index));\n\n                            case 5:\n                            case \"end\":\n                                return _context25.stop();\n                        }\n                    }\n                }, _callee25, this);\n            }));\n\n            function updateLastConsumedMessageIndex(_x15) {\n                return _ref25.apply(this, arguments);\n            }\n\n            return updateLastConsumedMessageIndex;\n        }()\n        /**\n         * Update the Channel's unique name.\n         * @param {String} uniqueName - The new Channel uniqueName\n         * @returns {Promise<Channel|SessionError>}\n         */\n\n    }, {\n        key: \"updateUniqueName\",\n        value: function () {\n            var _ref26 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee26(uniqueName) {\n                return _regenerator2.default.wrap(function _callee26$(_context26) {\n                    while (1) {\n                        switch (_context26.prev = _context26.next) {\n                            case 0:\n                                if (!(this.channelState.uniqueName !== uniqueName)) {\n                                    _context26.next = 4;\n                                    break;\n                                }\n\n                                if (!uniqueName) {\n                                    uniqueName = '';\n                                }\n                                _context26.next = 4;\n                                return this.services.session.addCommand('editUniqueName', {\n                                    channelSid: this.sid,\n                                    uniqueName: uniqueName\n                                });\n\n                            case 4:\n                                return _context26.abrupt(\"return\", this);\n\n                            case 5:\n                            case \"end\":\n                                return _context26.stop();\n                        }\n                    }\n                }, _callee26, this);\n            }));\n\n            function updateUniqueName(_x16) {\n                return _ref26.apply(this, arguments);\n            }\n\n            return updateUniqueName;\n        }()\n        /**\n         * Gets User Descriptors for this channel.\n         * @returns {Promise<Paginator<UserDescriptor>>}\n         */\n\n    }, {\n        key: \"getUserDescriptors\",\n        value: function () {\n            var _ref27 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee27() {\n                return _regenerator2.default.wrap(function _callee27$(_context27) {\n                    while (1) {\n                        switch (_context27.prev = _context27.next) {\n                            case 0:\n                                return _context27.abrupt(\"return\", this.services.users.getChannelUserDescriptors(this.sid));\n\n                            case 1:\n                            case \"end\":\n                                return _context27.stop();\n                        }\n                    }\n                }, _callee27, this);\n            }));\n\n            function getUserDescriptors() {\n                return _ref27.apply(this, arguments);\n            }\n\n            return getUserDescriptors;\n        }()\n    }, {\n        key: \"status\",\n        get: function get() {\n            return this.channelState.status;\n        }\n    }, {\n        key: \"type\",\n        get: function get() {\n            return this.channelState.type;\n        }\n    }, {\n        key: \"uniqueName\",\n        get: function get() {\n            return this.channelState.uniqueName;\n        }\n    }, {\n        key: \"isPrivate\",\n        get: function get() {\n            return this.channelState.type === 'private';\n        }\n    }, {\n        key: \"friendlyName\",\n        get: function get() {\n            return this.channelState.friendlyName;\n        }\n    }, {\n        key: \"dateUpdated\",\n        get: function get() {\n            return this.channelState.dateUpdated;\n        }\n    }, {\n        key: \"dateCreated\",\n        get: function get() {\n            return this.channelState.dateCreated;\n        }\n    }, {\n        key: \"createdBy\",\n        get: function get() {\n            return this.channelState.createdBy;\n        }\n    }, {\n        key: \"attributes\",\n        get: function get() {\n            return this.channelState.attributes;\n        }\n    }, {\n        key: \"lastConsumedMessageIndex\",\n        get: function get() {\n            return this.channelState.lastConsumedMessageIndex;\n        }\n    }, {\n        key: \"lastMessage\",\n        get: function get() {\n            return this.channelState.lastMessage;\n        }\n    }, {\n        key: \"notificationLevel\",\n        get: function get() {\n            return this.channelState.notificationLevel;\n        }\n    }, {\n        key: \"state\",\n        get: function get() {\n            return this.channelState.state;\n        }\n    }], [{\n        key: \"preprocessUpdate\",\n        value: function preprocessUpdate(update, channelSid) {\n            try {\n                if (typeof update.attributes === 'string') {\n                    update.attributes = JSON.parse(update.attributes);\n                } else if (update.attributes) {\n                    (0, _stringify2.default)(update.attributes);\n                }\n            } catch (e) {\n                log.warn('Retrieved malformed attributes from the server for channel: ' + channelSid);\n                update.attributes = {};\n            }\n            try {\n                if (update.dateCreated) {\n                    update.dateCreated = new Date(update.dateCreated);\n                }\n            } catch (e) {\n                log.warn('Retrieved malformed dateCreated from the server for channel: ' + channelSid);\n                delete update.dateCreated;\n            }\n            try {\n                if (update.dateUpdated) {\n                    update.dateUpdated = new Date(update.dateUpdated);\n                }\n            } catch (e) {\n                log.warn('Retrieved malformed dateUpdated from the server for channel: ' + channelSid);\n                delete update.dateUpdated;\n            }\n            try {\n                if (update.lastMessage && update.lastMessage.timestamp) {\n                    update.lastMessage.timestamp = new Date(update.lastMessage.timestamp);\n                }\n            } catch (e) {\n                log.warn('Retrieved malformed lastMessage.timestamp from the server for channel: ' + channelSid);\n                delete update.lastMessage.timestamp;\n            }\n        }\n    }]);\n    return Channel;\n}(events_1.EventEmitter);\n\nexports.Channel = Channel;\n/**\n * Fired when a Member has joined the Channel.\n * @event Channel#memberJoined\n * @type {Member}\n */\n/**\n * Fired when a Member has left the Channel.\n * @event Channel#memberLeft\n * @type {Member}\n */\n/**\n * Fired when a Member's fields has been updated.\n * @event Channel#memberUpdated\n * @type {Object}\n * @property {Member} member - Updated Member\n * @property {Member#UpdateReason[]} updateReasons - Array of Member's updated event reasons\n */\n/**\n * Fired when a new Message has been added to the Channel.\n * @event Channel#messageAdded\n * @type {Message}\n */\n/**\n * Fired when Message is removed from Channel's message list.\n * @event Channel#messageRemoved\n * @type {Message}\n */\n/**\n * Fired when an existing Message's fields are updated with new values.\n * @event Channel#messageUpdated\n * @type {Object}\n * @property {Message} message - Updated Message\n * @property {Message#UpdateReason[]} updateReasons - Array of Message's updated event reasons\n */\n/**\n * Fired when a Member has stopped typing.\n * @event Channel#typingEnded\n * @type {Member}\n */\n/**\n * Fired when a Member has started typing.\n * @event Channel#typingStarted\n * @type {Member}\n */\n/**\n * Fired when a Channel's attributes or metadata have been updated.\n * During Channel's {@link Client.create | creation and initialization} this event might be fired multiple times\n * for same joined or created Channel as new data is arriving from different sources.\n * @event Channel#updated\n * @type {Object}\n * @property {Channel} channel - Updated Channel\n * @property {Channel#UpdateReason[]} updateReasons - Array of Channel's updated event reasons\n */\n/**\n * Fired when the Channel was destroyed or currently logged in User has left private Channel\n * @event Channel#removed\n * @type {Channel}\n */"]},"metadata":{},"sourceType":"script"}