{"ast":null,"code":"import _taggedTemplateLiteral from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport _regeneratorRuntime from \"/root/twilio-phone-client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/inherits\";\n\nvar _jsxFileName = \"/root/twilio-phone-client/src/components/MsgComposer.js\",\n    _templateObject,\n    _templateObject2,\n    _templateObject3,\n    _templateObject4,\n    _templateObject5,\n    _templateObject6,\n    _templateObject7,\n    _templateObject8;\n\nimport React, { Component } from 'react';\nimport styled, { keyframes, css } from 'styled-components';\nimport chroma from 'chroma-js';\nimport { formParams } from '../lib/common';\nvar textAreaMaxHeight = 82; // px\n\nvar msgOutboundUrl = (process.env.REACT_APP_RUNTIME_DOMAIN ? process.env.REACT_APP_RUNTIME_DOMAIN : '') + '/msgOutbound';\nvar hover_accent = chroma(process.env.REACT_APP_ACCENT_COLOR).darken().hex();\n\nvar MsgComposer = /*#__PURE__*/function (_Component) {\n  _inherits(MsgComposer, _Component);\n\n  function MsgComposer(props) {\n    var _this;\n\n    _classCallCheck(this, MsgComposer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MsgComposer).call(this, props));\n\n    _this.handleChange = function (e) {\n      _this.setState({\n        msgText: e.target.value\n      });\n\n      _this.resizeTextArea(e.target);\n    };\n\n    _this.handleKeyDown = function (e) {\n      if (e.keyCode === 13) {\n        // Enter\n        if (e.shiftKey) {\n          _this.resizeTextArea(e.target);\n        } else {\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.handleSend();\n        }\n      }\n    };\n\n    _this.handleSend = function () {\n      _this.setState({\n        sending: true\n      });\n\n      var contact = _this.props.selectedContact;\n      var toNumber = contact;\n\n      if (contact === 'new') {\n        toNumber = _this.normalizePhoneNumber(_this.props.newPhoneNumber);\n      }\n\n      var body = formParams({\n        to: toNumber,\n        body: _this.state.msgText,\n        secret: _this.props.secret\n      });\n      fetch(msgOutboundUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: body\n      }).then( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n          var errText;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (!(response.status === 200)) {\n                    _context.next = 6;\n                    break;\n                  }\n\n                  _this.setState({\n                    msgText: '',\n                    sending: false,\n                    error: null\n                  });\n\n                  if (contact === 'new') {\n                    _this.props.updateNewPhoneNumber('');\n\n                    _this.props.selectContact(toNumber);\n                  }\n\n                  _this.resizeTextArea(_this.msgTextRef.current);\n\n                  _context.next = 11;\n                  break;\n\n                case 6:\n                  _context.next = 8;\n                  return response.text();\n\n                case 8:\n                  errText = _context.sent;\n                  console.error(response.status, errText);\n\n                  _this.setState({\n                    sending: false,\n                    error: errText\n                  });\n\n                case 11:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }()).catch(function (err) {\n        _this.setState({\n          sending: false,\n          error: 'Backend err:' + err\n        });\n\n        console.error('Error while sending message:', err);\n      });\n    };\n\n    _this.state = {\n      msgText: '',\n      sending: false,\n      error: null\n    };\n    _this.msgTextRef = React.createRef();\n    return _this;\n  }\n\n  _createClass(MsgComposer, [{\n    key: \"resizeTextArea\",\n    value: function resizeTextArea(textArea) {\n      textArea.style.height = 'inherit';\n      textArea.style.height = \"\".concat(Math.min(textArea.scrollHeight, textAreaMaxHeight), \"px\");\n      textArea.focus();\n    }\n  }, {\n    key: \"normalizePhoneNumber\",\n    value: function normalizePhoneNumber(phoneNumber) {\n      return phoneNumber.replace(/[()\\- ]/g, '');\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return [this.state.error ? /*#__PURE__*/React.createElement(Error, {\n        key: \"error\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(ErrorText, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 11\n        }\n      }, this.state.error)) : null, /*#__PURE__*/React.createElement(Container, {\n        key: \"msgComposer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(TextAreaContainer, {\n        key: \"txtAreaContainer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(TextArea, {\n        rows: \"1\",\n        autoFocus: true,\n        placeholder: \"Type message\",\n        ref: this.msgTextRef,\n        value: this.state.msgText,\n        onChange: this.handleChange,\n        onKeyDown: this.handleKeyDown,\n        disabled: this.state.sending,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(BtnSend, {\n        key: \"btnSend\",\n        disabled: this.state.msgText === '' || this.state.sending,\n        sending: this.state.sending,\n        onClick: this.handleSend,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 9\n        }\n      }, IcoSend))];\n    }\n  }]);\n\n  return MsgComposer;\n}(Component);\n\nexport { MsgComposer as default };\nvar Container = styled.div(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n  flex-grow: 1;\\n  flex-shrink: 0;\\n\\n  min-height: 2.5em;\\n  max-height: 85px;\\n  color: rgb(34, 34, 34);\\n  position: relative;\\n  overflow-x: hidden;\\n\\n  display: flex;\\n  flex-wrap: nowrap;\\n  -webkit-box-flex: 0;\\n  flex-direction: row;\\n  background: #ffffff;\\n  padding-top: 8px;\\n  padding-bottom: 12px;\\n  margin-left: 12px;\\n  margin-right: 12px;\\n\"])));\nvar TextAreaContainer = styled.div(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n  display: flex;\\n  align-self: flex-end;\\n  padding-top: 5px;\\n  padding-bottom: 5px;\\n  flex-grow: 1;\\n  flex-shrink: 1;\\n  width: 100vw;\\n  box-sizing: border-box;\\n  color: rgb(34, 34, 34);\\n  overflow: hidden;\\n  background: rgb(236, 237, 241);\\n  border-radius: 18px;\\n\"])));\nvar TextArea = styled.textarea(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n  font-size: 12px;\\n  display: block;\\n  width: 100vw;\\n  resize: none;\\n  box-sizing: border-box;\\n  padding-left: 12px;\\n  padding-right: 12px;\\n  padding-top: 6px;\\n  padding-bottom: 6px;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\\n    sans-serif;\\n  color: \", \";\\n  border-width: 0px;\\n  border-style: initial;\\n  border-color: initial;\\n  border-image: initial;\\n  outline: none;\\n  background: rgb(236, 237, 241);\\n\"])), function (props) {\n  return props.disabled ? '#94979B' : 'rgb(34, 34, 34)';\n});\nvar flash = keyframes(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\n    0% { opacity: 0.25; }\\n   50% { opacity: 0.50; }\\n  100% { opacity: 0.25; }\\n\"])));\nvar BtnSend = styled.button(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\\n  flex-grow: 0;\\n  flex-shrink: 0;\\n  align-self: flex-end;\\n  width: 36px;\\n  height: 36px;\\n  color: rgb(255, 255, 255);\\n  padding: 0px;\\n  border-width: initial;\\n  border-style: none;\\n  border-color: initial;\\n  border-image: initial;\\n  outline: none;\\n  border-radius: 100px;\\n  background: \", \";\\n  margin-left: 8px;\\n  \", \"\\n  animation: \", \";\\n\"])), process.env.REACT_APP_ACCENT_COLOR, function (props) {\n  return props.disabled ? \"\\n    opacity: 0.5;\\n    cursor: default;\\n    \" : \"\\n    opacity: 1;\\n    cursor: pointer;\\n    &:hover { background: \".concat(hover_accent, \"; }\\n    \");\n}, function (props) {\n  return props.sending ? css(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"\\n          \", \" 1s ease-in-out infinite\\n        \"])), flash) : '';\n});\nvar Error = styled.div(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"\\n  text-align: center;\\n  padding: 2px;\\n  margin: 0;\\n\"])));\nvar ErrorText = styled.div(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"\\n  padding: 3px 20px 3px 20px;\\n  margin:0;\\n  display: inline-block\\n  background: #fbcbd0;\\n  color: #F22F46;\\n  border-radius: 9px;\\n  font-weight: 400;\\n\"])));\nvar IcoSend = /*#__PURE__*/React.createElement(\"svg\", {\n  width: \"24px\",\n  height: \"24px\",\n  className: \"Twilio-Icon-Content\",\n  viewBox: \"0 0 24 24\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 248,\n    columnNumber: 3\n  }\n}, /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  fillRule: \"evenodd\",\n  d: \"M19.641 4c.164 0 .27.064.317.193.047.13.023.305-.07.528l-7.19 16.77a.761.761 0 01-.237.36.501.501 0 01-.308.114.494.494 0 01-.281-.097.989.989 0 01-.264-.29L8.76 16.92a4.609 4.609 0 00-.73-.905 5.269 5.269 0 00-.904-.747L2.38 12.314c-.27-.175-.396-.372-.378-.588.017-.217.172-.39.465-.519l16.788-7.12c.07-.023.137-.043.202-.06A.701.701 0 0119.64 4zM7.723 14.266c.117.07.238.155.36.255.124.1.25.208.379.325l8.314-8.455-12.902 5.484 3.85 2.39zm4.342 5.818l5.52-12.92-8.332 8.473c.105.117.202.234.29.351.088.117.16.235.22.352l2.302 3.744z\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 254,\n    columnNumber: 5\n  }\n}));","map":{"version":3,"sources":["/root/twilio-phone-client/src/components/MsgComposer.js"],"names":["React","Component","styled","keyframes","css","chroma","formParams","textAreaMaxHeight","msgOutboundUrl","process","env","REACT_APP_RUNTIME_DOMAIN","hover_accent","REACT_APP_ACCENT_COLOR","darken","hex","MsgComposer","props","handleChange","e","setState","msgText","target","value","resizeTextArea","handleKeyDown","keyCode","shiftKey","preventDefault","stopPropagation","handleSend","sending","contact","selectedContact","toNumber","normalizePhoneNumber","newPhoneNumber","body","to","state","secret","fetch","method","headers","then","response","status","error","updateNewPhoneNumber","selectContact","msgTextRef","current","text","errText","console","catch","err","createRef","textArea","style","height","Math","min","scrollHeight","focus","phoneNumber","replace","IcoSend","Container","div","TextAreaContainer","TextArea","textarea","disabled","flash","BtnSend","button","Error","ErrorText"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport styled, { keyframes, css } from 'styled-components';\nimport chroma from 'chroma-js';\nimport { formParams } from '../lib/common';\n\nconst textAreaMaxHeight = 82; // px\nconst msgOutboundUrl =\n  (process.env.REACT_APP_RUNTIME_DOMAIN\n    ? process.env.REACT_APP_RUNTIME_DOMAIN\n    : '') + '/msgOutbound';\n\nconst hover_accent = chroma(process.env.REACT_APP_ACCENT_COLOR).darken().hex();\n\nexport default class MsgComposer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      msgText: '',\n      sending: false,\n      error: null\n    };\n    this.msgTextRef = React.createRef();\n  }\n\n  resizeTextArea(textArea) {\n    textArea.style.height = 'inherit';\n    textArea.style.height = `${Math.min(\n      textArea.scrollHeight,\n      textAreaMaxHeight\n    )}px`;\n    textArea.focus();\n  }\n\n  handleChange = (e) => {\n    this.setState({ msgText: e.target.value });\n    this.resizeTextArea(e.target);\n  };\n\n  handleKeyDown = (e) => {\n    if (e.keyCode === 13) {\n      // Enter\n      if (e.shiftKey) {\n        this.resizeTextArea(e.target);\n      } else {\n        e.preventDefault();\n        e.stopPropagation();\n        this.handleSend();\n      }\n    }\n  };\n\n  normalizePhoneNumber(phoneNumber) {\n    return phoneNumber.replace(/[()\\- ]/g, '');\n  }\n\n  handleSend = () => {\n    this.setState({ sending: true });\n\n    const contact = this.props.selectedContact;\n    let toNumber = contact;\n    if (contact === 'new') {\n      toNumber = this.normalizePhoneNumber(this.props.newPhoneNumber);\n    }\n    const body = formParams({\n      to: toNumber,\n      body: this.state.msgText,\n      secret: this.props.secret\n    });\n\n    fetch(msgOutboundUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      },\n      body\n    })\n      .then(async (response) => {\n        if (response.status === 200) {\n          this.setState({ msgText: '', sending: false, error: null });\n          if (contact === 'new') {\n            this.props.updateNewPhoneNumber('');\n            this.props.selectContact(toNumber);\n          }\n          this.resizeTextArea(this.msgTextRef.current);\n        } else {\n          const errText = await response.text();\n          console.error(response.status, errText);\n          this.setState({ sending: false, error: errText });\n        }\n      })\n      .catch((err) => {\n        this.setState({ sending: false, error: 'Backend err:' + err });\n        console.error('Error while sending message:', err);\n      });\n  };\n\n  render() {\n    return [\n      this.state.error ? (\n        <Error key=\"error\">\n          <ErrorText>{this.state.error}</ErrorText>\n        </Error>\n      ) : null,\n      <Container key=\"msgComposer\">\n        <TextAreaContainer key=\"txtAreaContainer\">\n          <TextArea\n            rows=\"1\"\n            autoFocus\n            placeholder=\"Type message\"\n            ref={this.msgTextRef}\n            value={this.state.msgText}\n            onChange={this.handleChange}\n            onKeyDown={this.handleKeyDown}\n            disabled={this.state.sending}\n          />\n        </TextAreaContainer>\n        <BtnSend\n          key=\"btnSend\"\n          disabled={this.state.msgText === '' || this.state.sending}\n          sending={this.state.sending}\n          onClick={this.handleSend}\n        >\n          {IcoSend}\n        </BtnSend>\n      </Container>\n    ];\n  }\n}\n\nconst Container = styled.div`\n  flex-grow: 1;\n  flex-shrink: 0;\n\n  min-height: 2.5em;\n  max-height: 85px;\n  color: rgb(34, 34, 34);\n  position: relative;\n  overflow-x: hidden;\n\n  display: flex;\n  flex-wrap: nowrap;\n  -webkit-box-flex: 0;\n  flex-direction: row;\n  background: #ffffff;\n  padding-top: 8px;\n  padding-bottom: 12px;\n  margin-left: 12px;\n  margin-right: 12px;\n`;\n\nconst TextAreaContainer = styled.div`\n  display: flex;\n  align-self: flex-end;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  flex-grow: 1;\n  flex-shrink: 1;\n  width: 100vw;\n  box-sizing: border-box;\n  color: rgb(34, 34, 34);\n  overflow: hidden;\n  background: rgb(236, 237, 241);\n  border-radius: 18px;\n`;\n\nconst TextArea = styled.textarea`\n  font-size: 12px;\n  display: block;\n  width: 100vw;\n  resize: none;\n  box-sizing: border-box;\n  padding-left: 12px;\n  padding-right: 12px;\n  padding-top: 6px;\n  padding-bottom: 6px;\n  overflow-x: hidden;\n  overflow-y: auto;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  color: ${(props) => (props.disabled ? '#94979B' : 'rgb(34, 34, 34)')};\n  border-width: 0px;\n  border-style: initial;\n  border-color: initial;\n  border-image: initial;\n  outline: none;\n  background: rgb(236, 237, 241);\n`;\n\nconst flash = keyframes`\n    0% { opacity: 0.25; }\n   50% { opacity: 0.50; }\n  100% { opacity: 0.25; }\n`;\n\nconst BtnSend = styled.button`\n  flex-grow: 0;\n  flex-shrink: 0;\n  align-self: flex-end;\n  width: 36px;\n  height: 36px;\n  color: rgb(255, 255, 255);\n  padding: 0px;\n  border-width: initial;\n  border-style: none;\n  border-color: initial;\n  border-image: initial;\n  outline: none;\n  border-radius: 100px;\n  background: ${process.env.REACT_APP_ACCENT_COLOR};\n  margin-left: 8px;\n  ${(props) =>\n    props.disabled\n      ? `\n    opacity: 0.5;\n    cursor: default;\n    `\n      : `\n    opacity: 1;\n    cursor: pointer;\n    &:hover { background: ${hover_accent}; }\n    `}\n  animation: ${(props) =>\n    props.sending\n      ? css`\n          ${flash} 1s ease-in-out infinite\n        `\n      : ''};\n`;\n\nconst Error = styled.div`\n  text-align: center;\n  padding: 2px;\n  margin: 0;\n`;\n\nconst ErrorText = styled.div`\n  padding: 3px 20px 3px 20px;\n  margin:0;\n  display: inline-block\n  background: #fbcbd0;\n  color: #F22F46;\n  border-radius: 9px;\n  font-weight: 400;\n`;\n\nconst IcoSend = (\n  <svg\n    width=\"24px\"\n    height=\"24px\"\n    className=\"Twilio-Icon-Content\"\n    viewBox=\"0 0 24 24\"\n  >\n    <path\n      fill=\"currentColor\"\n      fillRule=\"evenodd\"\n      d=\"M19.641 4c.164 0 .27.064.317.193.047.13.023.305-.07.528l-7.19 16.77a.761.761 0 01-.237.36.501.501 0 01-.308.114.494.494 0 01-.281-.097.989.989 0 01-.264-.29L8.76 16.92a4.609 4.609 0 00-.73-.905 5.269 5.269 0 00-.904-.747L2.38 12.314c-.27-.175-.396-.372-.378-.588.017-.217.172-.39.465-.519l16.788-7.12c.07-.023.137-.043.202-.06A.701.701 0 0119.64 4zM7.723 14.266c.117.07.238.155.36.255.124.1.25.208.379.325l8.314-8.455-12.902 5.484 3.85 2.39zm4.342 5.818l5.52-12.92-8.332 8.473c.105.117.202.234.29.351.088.117.16.235.22.352l2.302 3.744z\"\n    ></path>\n  </svg>\n);\n"]},"metadata":{},"sourceType":"module"}