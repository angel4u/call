{"ast":null,"code":"import _taggedTemplateLiteral from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport _defineProperty from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/root/twilio-phone-client/node_modules/@babel/runtime/helpers/esm/inherits\";\n\nvar _jsxFileName = \"/root/twilio-phone-client/src/components/CallCanvas.js\",\n    _templateObject,\n    _templateObject2,\n    _templateObject3,\n    _templateObject4,\n    _templateObject5,\n    _templateObject6;\n\nimport React, { Component } from 'react';\nimport update from 'immutability-helper';\nimport styled from 'styled-components';\nimport { BtnDialRed, BtnDialGreen, DialRed, DialGreen } from './CallDialpadComponents';\nimport { ModalMessage } from './CommonComponents';\nimport { AsYouType } from 'libphonenumber-js';\nimport CallDialpad from './CallDialpad';\n\nvar CanvasMsg = /*#__PURE__*/function (_Component) {\n  _inherits(CanvasMsg, _Component);\n\n  function CanvasMsg(props) {\n    var _this;\n\n    _classCallCheck(this, CanvasMsg);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CanvasMsg).call(this, props));\n\n    _this.connectCall = function () {\n      if (_this.props.client.status() !== 'ready') {\n        console.error('Client is not ready (' + _this.props.client.status() + ')');\n        return;\n      }\n\n      console.log('Dialing', _this.props.callDisplay);\n\n      _this.props.setCallConnection(_this.props.client.connect({\n        number: _this.props.callDisplay\n      }));\n\n      _this.props.getCallConnection().on('mute', function (isMuted) {\n        _this.setState({\n          isMuted: isMuted\n        });\n      });\n\n      _this.props.setCallTypingPN(false);\n\n      _this.props.setCallNextKeyReset(true);\n\n      _this.props.setCallStartTime(new Date());\n\n      _this.timer = setTimeout(_this.tick, 1000);\n    };\n\n    _this.tick = function () {\n      var now = new Date();\n\n      _this.setState({\n        elapsedTime: now - _this.props.getCallStartTime()\n      });\n\n      _this.timer = setTimeout(_this.tick, 1000 - now % 1000);\n    };\n\n    _this.hangupCall = function () {\n      _this.props.client.disconnectAll();\n    };\n\n    _this.wrapupCall = function () {\n      clearTimeout(_this.timer);\n\n      _this.setState({\n        elapsedTime: null,\n        isMuted: false\n      }); // Destroy any pending connection listeners\n\n\n      if (_this.props.getCallConnection()) {\n        _this.props.getCallConnection().removeAllListeners('mute');\n      }\n    };\n\n    _this.toggleMute = function () {\n      _this.props.getCallConnection().mute(!_this.props.getCallConnection().isMuted());\n    };\n\n    _this.dialPressed = function (dial) {\n      var _display = _this.props.callDisplay; // reset display (e.g. after call is placed)\n\n      if (_this.props.getCallNextKeyReset() && dial.match(/^[0-9+#*]$/)) {\n        _this.props.setCallDisplay('');\n\n        _display = '';\n\n        _this.props.setCallNextKeyReset(false);\n      }\n\n      if (dial.match(/^[0-9#*]$/)) {\n        _this.updateDisplay(_display + dial);\n      } else if (dial === 'Backspace') {\n        if (_display.charAt(_display.length - 1) === ')') {\n          _this.updateDisplay(_display.substr(0, _display.length - 2));\n        } else {\n          _this.updateDisplay(_display.substr(0, _display.length - 1));\n        }\n      } else if (dial === '+') {\n        if (_display === '') {\n          _this.updateDisplay('+');\n        }\n      }\n\n      _this.numberInputRef.current.focus();\n\n      _this.runPressEvents(dial);\n    };\n\n    _this.dialFakeReset = function (dial) {\n      if (_this.state.dialActive[dial] !== undefined) {\n        _this.setState({\n          dialActive: update(_this.state.dialActive, _defineProperty({}, dial, {\n            $set: false\n          }))\n        });\n      }\n    };\n\n    _this.dialFakePressed = function (dial) {\n      if (_this.state.dialActive[dial] !== undefined) {\n        _this.setState({\n          dialActive: update(_this.state.dialActive, _defineProperty({}, dial, {\n            $set: true\n          }))\n        });\n      }\n\n      _this.runPressEvents(dial); // sometimes if multiple keys are pressed simultaneously, keyUp event doesn't fire so clean by timeout\n\n\n      setTimeout(_this.dialFakeReset.bind(null, dial), 300);\n    };\n\n    _this.handleKeyUp = function (e) {\n      _this.dialFakeReset(e.key);\n    };\n\n    _this.handleKeyDown = function (e) {\n      // handle edge-case when backspace is pressed right after ')' (which would delete that char, but not the digit before it)\n      if (e.key === 'Backspace' && e.target.value.charAt(e.target.selectionStart - 1) === ')') {\n        var _display = _this.props.callDisplay;\n        _display = _display.substr(0, _display.length - 1);\n\n        _this.props.setCallDisplay(_display);\n      }\n\n      if (e.ctrlKey || e.metaKey || e.altKey) return;\n      var allowedKeys = ['+', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '*', '#', 'Backspace', 'Enter'];\n\n      if (!allowedKeys.includes(e.key)) {\n        e.preventDefault();\n        e.stopPropagation();\n      } else {\n        // reset display (e.g. after call is placed)\n        if (_this.props.getCallNextKeyReset()) {\n          _this.props.setCallDisplay('');\n\n          _this.props.setCallNextKeyReset(false);\n        } // simulate events as if a real dial was pressed\n\n\n        _this.dialFakePressed(e.key);\n      }\n    };\n\n    _this.handleChange = function (e) {\n      _this.updateDisplay(e.target.value);\n    };\n\n    _this.formatNumber = function (number) {\n      _this.asYouType.reset();\n\n      var result = _this.asYouType.input(number);\n\n      return result === '' ? number : result;\n    };\n\n    _this.updateDisplay = function (newValue) {\n      if (_this.props.getCallTypingPN() === true) {\n        _this.asYouType.reset();\n\n        var result = _this.asYouType.input(newValue);\n\n        if (result !== '') {\n          _this.props.setCallDisplay(result);\n        } else {\n          _this.props.setCallDisplay(newValue);\n        }\n      } else {\n        _this.props.setCallDisplay(newValue);\n      }\n    };\n\n    _this.focusDisplay = function () {\n      if (_this.numberInputRef.current) {\n        _this.numberInputRef.current.focus();\n      }\n    };\n\n    _this.bindListeners = function () {\n      if (_this.props.client && !_this.handlersSet) {\n        /*this.props.client.on('connect', (conn) => {\n          console.log('CC: CONNECT event fired');\n        });*/\n        _this.props.client.on('disconnect', _this.disconnectHandler); // if there's an active connection already in place\n        // (i.e. switching from SMS canvas after placing a call)\n\n\n        if (_this.props.getCallConnection() && _this.props.getCallConnection().status() !== 'closed') {\n          // re-set mute event listener\n          _this.props.getCallConnection().on('mute', function (isMuted) {\n            _this.setState({\n              isMuted: isMuted\n            });\n          }); // and update mute button's state\n\n\n          _this.setState({\n            isMuted: _this.props.getCallConnection().isMuted()\n          }); // re-set elapsed time timer\n\n\n          _this.timer = setTimeout(_this.tick, 1000); // and update current elapsed time\n\n          var now = new Date();\n\n          _this.setState({\n            elapsedTime: now - _this.props.getCallStartTime()\n          });\n        }\n\n        _this.handlersSet = true;\n      }\n    };\n\n    _this.acceptIncomingCall = function (conn) {\n      if (conn) {\n        conn.accept();\n\n        _this.updateDisplay(conn.parameters.From);\n\n        _this.props.setCallTypingPN(false);\n\n        _this.props.setCallNextKeyReset(true);\n\n        _this.props.setCallStartTime(new Date());\n\n        _this.timer = setTimeout(_this.tick, 1000);\n\n        _this.props.getCallConnection().on('mute', function (isMuted) {\n          _this.setState({\n            isMuted: isMuted\n          });\n        });\n      } else {\n        console.error('No incoming connection found');\n      }\n    };\n\n    _this.rejectIncomingCall = function (conn) {\n      if (conn) {\n        conn.reject();\n      } else {\n        console.error('No incoming connection found');\n      }\n    };\n\n    _this.asYouType = new AsYouType('US');\n    _this.timer = null;\n    var dialActive = {};\n    ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '*', '#', 'Backspace', 'Enter'].forEach(function (key) {\n      dialActive[key] = false;\n    });\n    _this.state = {\n      elapsedTime: null,\n      dialActive: dialActive,\n      isMuted: false,\n      incomingRing: false,\n      incomingConnection: null\n    };\n    _this.numberInputRef = React.createRef();\n\n    _this.disconnectHandler = function (connection) {\n      console.log('CC: DISCONNECT event fired');\n\n      _this.wrapupCall();\n    };\n\n    _this.handlersSet = false;\n    _this.theme = {\n      color: '#222222',\n      colorToggled: '#FFFFFF',\n      dial: '#E8E8E8',\n      dialActive: '#94979B',\n      dialToggled: '#6f7174',\n      dialGreen: '#36D576',\n      dialGreenActive: '#289f58',\n      dialRed: '#F22F46',\n      dialRedActive: '#B52334'\n    };\n    return _this;\n  }\n\n  _createClass(CanvasMsg, [{\n    key: \"runPressEvents\",\n    value: function runPressEvents(digit) {\n      if (digit === 'Enter') {\n        this.connectCall();\n      } else if (digit === 'Backspace') {\n        return;\n      } else if (digit === 'Hangup') {\n        this.hangupCall();\n      } else if (digit === 'ToggleMute') {\n        this.toggleMute();\n      } else {\n        // send DTMF\n        if (this.props.client.activeConnection() && '0123456789#*'.includes(digit)) {\n          this.props.client.activeConnection().sendDigits(digit);\n        }\n      }\n    }\n    /**\n     * Outbound call\n     */\n\n  }, {\n    key: \"showTime\",\n    value: function showTime(milis) {\n      var date = new Date(null);\n      date.setMilliseconds(milis);\n\n      if (milis) {\n        return (date.getUTCHours() > 0 ? date.getUTCHours() + ':' : '') + date.toISOString().substr(14, 5);\n      } else {\n        return '';\n      }\n    }\n  }, {\n    key: \"moveCaretToEnd\",\n    value: function moveCaretToEnd(e) {\n      e.target.selectionStart = e.target.value.length;\n      e.target.selectionEnd = e.target.value.length;\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      //this.props.client.removeAllListeners('incoming');\n      //this.props.client.removeAllListeners('connect');\n      //this.props.client.removeAllListeners('ready');\n      this.props.client.removeListener('disconnect', this.disconnectHandler);\n\n      if (this.props.getCallConnection()) {\n        this.props.getCallConnection().removeAllListeners('mute');\n      }\n\n      clearTimeout(this.timer);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.bindListeners();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      this.bindListeners();\n      /*if (\n        this.props.client &&\n        this.props.client.status() !== prevState.clientStatus\n      ) {\n        this.setState({ clientStatus: this.props.client.status() });\n      }*/\n\n      this.focusDisplay();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (!this.props.client || this.props.client.status() === 'offline') {\n        return /*#__PURE__*/React.createElement(Canvas, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(ModalMessage, {\n          msg: \"Voice client is offline\",\n          img: \"offline\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 364,\n            columnNumber: 11\n          }\n        }));\n      } else if (this.props.incomingCall !== null) {\n        return /*#__PURE__*/React.createElement(Canvas, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(Label1, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 11\n          }\n        }, \"Incoming call from\"), /*#__PURE__*/React.createElement(Label2, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 11\n          }\n        }, this.formatNumber(this.props.incomingCall.parameters.From)), /*#__PURE__*/React.createElement(IncomingDials, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 377,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(BtnDialRed, {\n          theme: this.theme,\n          key: \"RedDial\",\n          onClick: this.rejectIncomingCall.bind(null, this.props.incomingCall),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(DialRed, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 15\n          }\n        })), /*#__PURE__*/React.createElement(BtnDialGreen, {\n          theme: this.theme,\n          key: \"GreenDial\",\n          onClick: this.acceptIncomingCall.bind(null, this.props.incomingCall),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(DialGreen, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 396,\n            columnNumber: 15\n          }\n        }))));\n      } else {\n        return /*#__PURE__*/React.createElement(Canvas, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 403,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(Display, {\n          value: this.props.callDisplay,\n          onKeyDown: this.handleKeyDown,\n          onKeyUp: this.handleKeyUp,\n          onChange: this.handleChange,\n          onFocus: this.moveCaretToEnd,\n          onClick: this.moveCaretToEnd,\n          onBlur: this.focusDisplay,\n          ref: this.numberInputRef,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 11\n          }\n        }), /*#__PURE__*/React.createElement(Timer, {\n          time: this.showTime(this.state.elapsedTime),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 414,\n            columnNumber: 11\n          }\n        }), /*#__PURE__*/React.createElement(CallDialpad, {\n          dialPressed: this.dialPressed,\n          dialActive: this.state.dialActive,\n          theme: this.theme,\n          callActive: this.props.client.activeConnection() !== undefined,\n          muted: this.state.isMuted,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 11\n          }\n        }));\n      }\n    }\n  }]);\n\n  return CanvasMsg;\n}(Component);\n\nexport { CanvasMsg as default };\nvar TimerDisplay = styled.div(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n  font-size: 4vmin;\\n  height: 4vmin;\\n  padding: 2vmin;\\n  @media (min-width: 400px) {\\n    font-size: 16px;\\n    height: 16px;\\n    padding: 8px;\\n  }\\n\"])));\n\nfunction Timer(props) {\n  return /*#__PURE__*/React.createElement(TimerDisplay, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 440,\n      columnNumber: 10\n    }\n  }, props.time);\n}\n\nvar Canvas = styled.div(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n  flex-grow: 1;\\n\\n  display: flex;\\n  flex-direction: column;\\n  flex-wrap: nowrap;\\n  align-items: center;\\n  height: 100vh;\\n  max-width: 440px;\\n  position: relative;\\n  overflow-x: hidden;\\n\\n  padding-left: 12px;\\n  padding-right: 12px;\\n\"])));\nvar Display = styled.input(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n  outline: none;\\n  margin-top: 10vmin;\\n  border-radius: 10px;\\n  height: 10vmin;\\n  width: 66vmin;\\n  font-size: 8vmin;\\n  text-align: center;\\n  padding: 0.5vmin 3vmin 0.5vmin 3vmin;\\n  @media (min-width: 400px) {\\n    margin-top: 40px;\\n    height: 40px;\\n    width: 264px;\\n    font-size: 32px;\\n    padding: 2px 12px 2px 12px;\\n  }\\n  border: 0;\\n  background: #e8e8e8;\\n  color: transparent;\\n  text-shadow: 0 0 0 #222222;\\n  &:focus {\\n    outline: none;\\n  }\\n\"])));\nvar Label1 = styled.div(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\n  outline: none;\\n  margin-top: 10vmin;\\n  border-radius: 10px;\\n  height: 6vmin;\\n  width: 66vmin;\\n  font-size: 4vmin;\\n  text-align: center;\\n  padding: 20vmin 3vmin 0.5vmin 3vmin;\\n  @media (min-width: 400px) {\\n    margin-top: 40px;\\n    height: 24px;\\n    width: 264px;\\n    font-size: 16px;\\n    padding: 80px 12px 2px 12px;\\n  }\\n  border: 0;\\n  &:focus {\\n    outline: none;\\n  }\\n\"])));\nvar Label2 = styled.div(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\\n  outline: none;\\n  height: 10vmin;\\n  width: 66vmin;\\n  font-size: 8vmin;\\n  text-align: center;\\n  padding: 1vmin 3vmin 0.5vmin 3vmin;\\n  @media (min-width: 400px) {\\n    height: 40px;\\n    width: 264px;\\n    font-size: 32px;\\n    padding: 4px 12px 2px 12px;\\n  }\\n  border: 0;\\n  &:focus {\\n    outline: none;\\n  }\\n\"])));\nvar IncomingDials = styled.div(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"\\n  display: grid;\\n  grid-template-columns: auto auto;\\n  position: relative;\\n  width: 80vmin;\\n  margin-top: 83vmin;\\n  justify-items: center;\\n  @media (min-width: 400px) {\\n    width: 320px;\\n    margin-top: 332px;\\n  }\\n\"])));","map":{"version":3,"sources":["/root/twilio-phone-client/src/components/CallCanvas.js"],"names":["React","Component","update","styled","BtnDialRed","BtnDialGreen","DialRed","DialGreen","ModalMessage","AsYouType","CallDialpad","CanvasMsg","props","connectCall","client","status","console","error","log","callDisplay","setCallConnection","connect","number","getCallConnection","on","isMuted","setState","setCallTypingPN","setCallNextKeyReset","setCallStartTime","Date","timer","setTimeout","tick","now","elapsedTime","getCallStartTime","hangupCall","disconnectAll","wrapupCall","clearTimeout","removeAllListeners","toggleMute","mute","dialPressed","dial","_display","getCallNextKeyReset","match","setCallDisplay","updateDisplay","charAt","length","substr","numberInputRef","current","focus","runPressEvents","dialFakeReset","state","dialActive","undefined","$set","dialFakePressed","bind","handleKeyUp","e","key","handleKeyDown","target","value","selectionStart","ctrlKey","metaKey","altKey","allowedKeys","includes","preventDefault","stopPropagation","handleChange","formatNumber","asYouType","reset","result","input","newValue","getCallTypingPN","focusDisplay","bindListeners","handlersSet","disconnectHandler","acceptIncomingCall","conn","accept","parameters","From","rejectIncomingCall","reject","forEach","incomingRing","incomingConnection","createRef","connection","theme","color","colorToggled","dialToggled","dialGreen","dialGreenActive","dialRed","dialRedActive","digit","activeConnection","sendDigits","milis","date","setMilliseconds","getUTCHours","toISOString","selectionEnd","removeListener","prevProps","prevState","incomingCall","moveCaretToEnd","showTime","TimerDisplay","div","Timer","time","Canvas","Display","Label1","Label2","IncomingDials"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport update from 'immutability-helper';\nimport styled from 'styled-components';\nimport {\n  BtnDialRed,\n  BtnDialGreen,\n  DialRed,\n  DialGreen\n} from './CallDialpadComponents';\nimport { ModalMessage } from './CommonComponents';\n\nimport { AsYouType } from 'libphonenumber-js';\n\nimport CallDialpad from './CallDialpad';\n\nexport default class CanvasMsg extends Component {\n  constructor(props) {\n    super(props);\n    this.asYouType = new AsYouType('US');\n    this.timer = null;\n\n    let dialActive = {};\n    [\n      '0',\n      '1',\n      '2',\n      '3',\n      '4',\n      '5',\n      '6',\n      '7',\n      '8',\n      '9',\n      '*',\n      '#',\n      'Backspace',\n      'Enter'\n    ].forEach((key) => {\n      dialActive[key] = false;\n    });\n\n    this.state = {\n      elapsedTime: null,\n      dialActive,\n      isMuted: false,\n      incomingRing: false,\n      incomingConnection: null\n    };\n\n    this.numberInputRef = React.createRef();\n    this.disconnectHandler = (connection) => {\n      console.log('CC: DISCONNECT event fired');\n      this.wrapupCall();\n    };\n    this.handlersSet = false;\n\n    this.theme = {\n      color: '#222222',\n      colorToggled: '#FFFFFF',\n      dial: '#E8E8E8',\n      dialActive: '#94979B',\n      dialToggled: '#6f7174',\n      dialGreen: '#36D576',\n      dialGreenActive: '#289f58',\n      dialRed: '#F22F46',\n      dialRedActive: '#B52334'\n    };\n  }\n\n  runPressEvents(digit) {\n    if (digit === 'Enter') {\n      this.connectCall();\n    } else if (digit === 'Backspace') {\n      return;\n    } else if (digit === 'Hangup') {\n      this.hangupCall();\n    } else if (digit === 'ToggleMute') {\n      this.toggleMute();\n    } else {\n      // send DTMF\n      if (\n        this.props.client.activeConnection() &&\n        '0123456789#*'.includes(digit)\n      ) {\n        this.props.client.activeConnection().sendDigits(digit);\n      }\n    }\n  }\n\n  /**\n   * Outbound call\n   */\n  connectCall = () => {\n    if (this.props.client.status() !== 'ready') {\n      console.error('Client is not ready (' + this.props.client.status() + ')');\n      return;\n    }\n    console.log('Dialing', this.props.callDisplay);\n    this.props.setCallConnection(\n      this.props.client.connect({\n        number: this.props.callDisplay\n      })\n    );\n    this.props.getCallConnection().on('mute', (isMuted) => {\n      this.setState({ isMuted });\n    });\n    this.props.setCallTypingPN(false);\n    this.props.setCallNextKeyReset(true);\n    this.props.setCallStartTime(new Date());\n    this.timer = setTimeout(this.tick, 1000);\n  };\n\n  tick = () => {\n    const now = new Date();\n    this.setState({ elapsedTime: now - this.props.getCallStartTime() });\n    this.timer = setTimeout(this.tick, 1000 - (now % 1000));\n  };\n\n  showTime(milis) {\n    const date = new Date(null);\n    date.setMilliseconds(milis);\n    if (milis) {\n      return (\n        (date.getUTCHours() > 0 ? date.getUTCHours() + ':' : '') +\n        date.toISOString().substr(14, 5)\n      );\n    } else {\n      return '';\n    }\n  }\n\n  hangupCall = () => {\n    this.props.client.disconnectAll();\n  };\n\n  /**\n   * Cleanup after a call has ended\n   */\n  wrapupCall = () => {\n    clearTimeout(this.timer);\n    this.setState({ elapsedTime: null, isMuted: false });\n    // Destroy any pending connection listeners\n    if (this.props.getCallConnection()) {\n      this.props.getCallConnection().removeAllListeners('mute');\n    }\n  };\n\n  toggleMute = () => {\n    this.props\n      .getCallConnection()\n      .mute(!this.props.getCallConnection().isMuted());\n  };\n\n  dialPressed = (dial) => {\n    let _display = this.props.callDisplay;\n    // reset display (e.g. after call is placed)\n    if (this.props.getCallNextKeyReset() && dial.match(/^[0-9+#*]$/)) {\n      this.props.setCallDisplay('');\n      _display = '';\n      this.props.setCallNextKeyReset(false);\n    }\n    if (dial.match(/^[0-9#*]$/)) {\n      this.updateDisplay(_display + dial);\n    } else if (dial === 'Backspace') {\n      if (_display.charAt(_display.length - 1) === ')') {\n        this.updateDisplay(_display.substr(0, _display.length - 2));\n      } else {\n        this.updateDisplay(_display.substr(0, _display.length - 1));\n      }\n    } else if (dial === '+') {\n      if (_display === '') {\n        this.updateDisplay('+');\n      }\n    }\n    this.numberInputRef.current.focus();\n    this.runPressEvents(dial);\n  };\n\n  dialFakeReset = (dial) => {\n    if (this.state.dialActive[dial] !== undefined) {\n      this.setState({\n        dialActive: update(this.state.dialActive, { [dial]: { $set: false } })\n      });\n    }\n  };\n\n  dialFakePressed = (dial) => {\n    if (this.state.dialActive[dial] !== undefined) {\n      this.setState({\n        dialActive: update(this.state.dialActive, { [dial]: { $set: true } })\n      });\n    }\n    this.runPressEvents(dial);\n    // sometimes if multiple keys are pressed simultaneously, keyUp event doesn't fire so clean by timeout\n    setTimeout(this.dialFakeReset.bind(null, dial), 300);\n  };\n\n  handleKeyUp = (e) => {\n    this.dialFakeReset(e.key);\n  };\n\n  handleKeyDown = (e) => {\n    // handle edge-case when backspace is pressed right after ')' (which would delete that char, but not the digit before it)\n    if (\n      e.key === 'Backspace' &&\n      e.target.value.charAt(e.target.selectionStart - 1) === ')'\n    ) {\n      let _display = this.props.callDisplay;\n      _display = _display.substr(0, _display.length - 1);\n      this.props.setCallDisplay(_display);\n    }\n    if (e.ctrlKey || e.metaKey || e.altKey) return;\n    const allowedKeys = [\n      '+',\n      '0',\n      '1',\n      '2',\n      '3',\n      '4',\n      '5',\n      '6',\n      '7',\n      '8',\n      '9',\n      '*',\n      '#',\n      'Backspace',\n      'Enter'\n    ];\n    if (!allowedKeys.includes(e.key)) {\n      e.preventDefault();\n      e.stopPropagation();\n    } else {\n      // reset display (e.g. after call is placed)\n      if (this.props.getCallNextKeyReset()) {\n        this.props.setCallDisplay('');\n        this.props.setCallNextKeyReset(false);\n      }\n      // simulate events as if a real dial was pressed\n      this.dialFakePressed(e.key);\n    }\n  };\n\n  handleChange = (e) => {\n    this.updateDisplay(e.target.value);\n  };\n\n  moveCaretToEnd(e) {\n    e.target.selectionStart = e.target.value.length;\n    e.target.selectionEnd = e.target.value.length;\n  }\n\n  formatNumber = (number) => {\n    this.asYouType.reset();\n    const result = this.asYouType.input(number);\n    return result === '' ? number : result;\n  };\n\n  updateDisplay = (newValue) => {\n    if (this.props.getCallTypingPN() === true) {\n      this.asYouType.reset();\n      const result = this.asYouType.input(newValue);\n      if (result !== '') {\n        this.props.setCallDisplay(result);\n      } else {\n        this.props.setCallDisplay(newValue);\n      }\n    } else {\n      this.props.setCallDisplay(newValue);\n    }\n  };\n\n  focusDisplay = () => {\n    if (this.numberInputRef.current) {\n      this.numberInputRef.current.focus();\n    }\n  };\n\n  componentWillUnmount() {\n    //this.props.client.removeAllListeners('incoming');\n    //this.props.client.removeAllListeners('connect');\n    //this.props.client.removeAllListeners('ready');\n    this.props.client.removeListener('disconnect', this.disconnectHandler);\n    if (this.props.getCallConnection()) {\n      this.props.getCallConnection().removeAllListeners('mute');\n    }\n    clearTimeout(this.timer);\n  }\n\n  bindListeners = () => {\n    if (this.props.client && !this.handlersSet) {\n      /*this.props.client.on('connect', (conn) => {\n        console.log('CC: CONNECT event fired');\n      });*/\n\n      this.props.client.on('disconnect', this.disconnectHandler);\n\n      // if there's an active connection already in place\n      // (i.e. switching from SMS canvas after placing a call)\n      if (\n        this.props.getCallConnection() &&\n        this.props.getCallConnection().status() !== 'closed'\n      ) {\n        // re-set mute event listener\n        this.props.getCallConnection().on('mute', (isMuted) => {\n          this.setState({ isMuted });\n        });\n        // and update mute button's state\n        this.setState({ isMuted: this.props.getCallConnection().isMuted() });\n\n        // re-set elapsed time timer\n        this.timer = setTimeout(this.tick, 1000);\n        // and update current elapsed time\n        const now = new Date();\n        this.setState({ elapsedTime: now - this.props.getCallStartTime() });\n      }\n      this.handlersSet = true;\n    }\n  };\n\n  componentDidMount() {\n    this.bindListeners();\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    this.bindListeners();\n    /*if (\n      this.props.client &&\n      this.props.client.status() !== prevState.clientStatus\n    ) {\n      this.setState({ clientStatus: this.props.client.status() });\n    }*/\n    this.focusDisplay();\n  }\n\n  acceptIncomingCall = (conn) => {\n    if (conn) {\n      conn.accept();\n      this.updateDisplay(conn.parameters.From);\n      this.props.setCallTypingPN(false);\n      this.props.setCallNextKeyReset(true);\n      this.props.setCallStartTime(new Date());\n      this.timer = setTimeout(this.tick, 1000);\n      this.props.getCallConnection().on('mute', (isMuted) => {\n        this.setState({ isMuted });\n      });\n    } else {\n      console.error('No incoming connection found');\n    }\n  };\n\n  rejectIncomingCall = (conn) => {\n    if (conn) {\n      conn.reject();\n    } else {\n      console.error('No incoming connection found');\n    }\n  };\n\n  render() {\n    if (!this.props.client || this.props.client.status() === 'offline') {\n      return (\n        <Canvas>\n          <ModalMessage\n            msg=\"Voice client is offline\"\n            img=\"offline\"\n          ></ModalMessage>\n        </Canvas>\n      );\n    } else if (this.props.incomingCall !== null) {\n      return (\n        <Canvas>\n          <Label1>Incoming call from</Label1>\n          <Label2>\n            {this.formatNumber(this.props.incomingCall.parameters.From)}\n          </Label2>\n          <IncomingDials>\n            <BtnDialRed\n              theme={this.theme}\n              key=\"RedDial\"\n              onClick={this.rejectIncomingCall.bind(\n                null,\n                this.props.incomingCall\n              )}\n            >\n              <DialRed></DialRed>\n            </BtnDialRed>\n            <BtnDialGreen\n              theme={this.theme}\n              key=\"GreenDial\"\n              onClick={this.acceptIncomingCall.bind(\n                null,\n                this.props.incomingCall\n              )}\n            >\n              <DialGreen></DialGreen>\n            </BtnDialGreen>\n          </IncomingDials>\n        </Canvas>\n      );\n    } else {\n      return (\n        <Canvas>\n          <Display\n            value={this.props.callDisplay}\n            onKeyDown={this.handleKeyDown}\n            onKeyUp={this.handleKeyUp}\n            onChange={this.handleChange}\n            onFocus={this.moveCaretToEnd}\n            onClick={this.moveCaretToEnd}\n            onBlur={this.focusDisplay}\n            ref={this.numberInputRef}\n          />\n          <Timer time={this.showTime(this.state.elapsedTime)} />\n          <CallDialpad\n            dialPressed={this.dialPressed}\n            dialActive={this.state.dialActive}\n            theme={this.theme}\n            callActive={this.props.client.activeConnection() !== undefined}\n            muted={this.state.isMuted}\n          />\n        </Canvas>\n      );\n    }\n  }\n}\n\nconst TimerDisplay = styled.div`\n  font-size: 4vmin;\n  height: 4vmin;\n  padding: 2vmin;\n  @media (min-width: 400px) {\n    font-size: 16px;\n    height: 16px;\n    padding: 8px;\n  }\n`;\n\nfunction Timer(props) {\n  return <TimerDisplay>{props.time}</TimerDisplay>;\n}\n\nconst Canvas = styled.div`\n  flex-grow: 1;\n\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  align-items: center;\n  height: 100vh;\n  max-width: 440px;\n  position: relative;\n  overflow-x: hidden;\n\n  padding-left: 12px;\n  padding-right: 12px;\n`;\n\nconst Display = styled.input`\n  outline: none;\n  margin-top: 10vmin;\n  border-radius: 10px;\n  height: 10vmin;\n  width: 66vmin;\n  font-size: 8vmin;\n  text-align: center;\n  padding: 0.5vmin 3vmin 0.5vmin 3vmin;\n  @media (min-width: 400px) {\n    margin-top: 40px;\n    height: 40px;\n    width: 264px;\n    font-size: 32px;\n    padding: 2px 12px 2px 12px;\n  }\n  border: 0;\n  background: #e8e8e8;\n  color: transparent;\n  text-shadow: 0 0 0 #222222;\n  &:focus {\n    outline: none;\n  }\n`;\n\nconst Label1 = styled.div`\n  outline: none;\n  margin-top: 10vmin;\n  border-radius: 10px;\n  height: 6vmin;\n  width: 66vmin;\n  font-size: 4vmin;\n  text-align: center;\n  padding: 20vmin 3vmin 0.5vmin 3vmin;\n  @media (min-width: 400px) {\n    margin-top: 40px;\n    height: 24px;\n    width: 264px;\n    font-size: 16px;\n    padding: 80px 12px 2px 12px;\n  }\n  border: 0;\n  &:focus {\n    outline: none;\n  }\n`;\n\nconst Label2 = styled.div`\n  outline: none;\n  height: 10vmin;\n  width: 66vmin;\n  font-size: 8vmin;\n  text-align: center;\n  padding: 1vmin 3vmin 0.5vmin 3vmin;\n  @media (min-width: 400px) {\n    height: 40px;\n    width: 264px;\n    font-size: 32px;\n    padding: 4px 12px 2px 12px;\n  }\n  border: 0;\n  &:focus {\n    outline: none;\n  }\n`;\n\nconst IncomingDials = styled.div`\n  display: grid;\n  grid-template-columns: auto auto;\n  position: relative;\n  width: 80vmin;\n  margin-top: 83vmin;\n  justify-items: center;\n  @media (min-width: 400px) {\n    width: 320px;\n    margin-top: 332px;\n  }\n`;\n"]},"metadata":{},"sourceType":"module"}