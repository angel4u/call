{"ast":null,"code":"\"use strict\";\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Deferred_1 = require(\"./Deferred\");\n\nvar EventTarget_1 = require(\"./EventTarget\");\n/**\n * An {@link AudioPlayer} is an HTMLAudioElement-like object that uses AudioContext\n *   to circumvent browser limitations.\n */\n\n\nvar AudioPlayer = function (_EventTarget_1$defaul) {\n  _inherits(AudioPlayer, _EventTarget_1$defaul);\n  /**\n   * @private\n   */\n\n\n  function AudioPlayer(audioContext) {\n    var srcOrOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    _classCallCheck(this, AudioPlayer);\n    /**\n     * The AudioBufferSourceNode of the actively loaded sound. Null if a sound\n     *   has not been loaded yet. This is re-used for each time the sound is\n     *   played.\n     */\n\n\n    var _this = _possibleConstructorReturn(this, (AudioPlayer.__proto__ || Object.getPrototypeOf(AudioPlayer)).call(this));\n\n    _this._audioNode = null;\n    /**\n     * An Array of deferred-like objects for each pending `play` Promise. When\n     *   .pause() is called or .src is set, all pending play Promises are\n     *   immediately rejected.\n     */\n\n    _this._pendingPlayDeferreds = [];\n    /**\n     * Whether or not the audio element should loop. If disabled during playback,\n     *   playing continues until the sound ends and then stops looping.\n     */\n\n    _this._loop = false;\n    /**\n     * The source URL of the sound to play. When set, the currently playing sound will stop.\n     */\n\n    _this._src = '';\n    /**\n     * The current sinkId of the device audio is being played through.\n     */\n\n    _this._sinkId = 'default';\n\n    if (typeof srcOrOptions !== 'string') {\n      options = srcOrOptions;\n    }\n\n    _this._audioContext = audioContext;\n    _this._audioElement = new (options.AudioFactory || Audio)();\n    _this._bufferPromise = _this._createPlayDeferred().promise;\n    _this._destination = _this._audioContext.destination;\n    _this._gainNode = _this._audioContext.createGain();\n\n    _this._gainNode.connect(_this._destination);\n\n    _this._XMLHttpRequest = options.XMLHttpRequestFactory || XMLHttpRequest;\n\n    _this.addEventListener('canplaythrough', function () {\n      _this._resolvePlayDeferreds();\n    });\n\n    if (typeof srcOrOptions === 'string') {\n      _this.src = srcOrOptions;\n    }\n\n    return _this;\n  }\n\n  _createClass(AudioPlayer, [{\n    key: \"load\",\n\n    /**\n     * Stop any ongoing playback and reload the source file.\n     */\n    value: function load() {\n      this._load(this._src);\n    }\n    /**\n     * Pause the audio coming from this AudioPlayer. This will reject any pending\n     *   play Promises.\n     */\n\n  }, {\n    key: \"pause\",\n    value: function pause() {\n      if (this.paused) {\n        return;\n      }\n\n      this._audioElement.pause();\n\n      this._audioNode.stop();\n\n      this._audioNode.disconnect(this._gainNode);\n\n      this._audioNode = null;\n\n      this._rejectPlayDeferreds(new Error('The play() request was interrupted by a call to pause().'));\n    }\n    /**\n     * Play the sound. If the buffer hasn't loaded yet, wait for the buffer to load. If\n     *   the source URL is not set yet, this Promise will remain pending until a source\n     *   URL is set.\n     */\n\n  }, {\n    key: \"play\",\n    value: function play() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n        var _this2 = this;\n\n        var buffer;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (this.paused) {\n                  _context.next = 6;\n                  break;\n                }\n\n                _context.next = 3;\n                return this._bufferPromise;\n\n              case 3:\n                if (this.paused) {\n                  _context.next = 5;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 5:\n                throw new Error('The play() request was interrupted by a call to pause().');\n\n              case 6:\n                this._audioNode = this._audioContext.createBufferSource();\n                this._audioNode.loop = this.loop;\n\n                this._audioNode.addEventListener('ended', function () {\n                  if (_this2._audioNode && _this2._audioNode.loop) {\n                    return;\n                  }\n\n                  _this2.dispatchEvent('ended');\n                });\n\n                _context.next = 11;\n                return this._bufferPromise;\n\n              case 11:\n                buffer = _context.sent;\n\n                if (!this.paused) {\n                  _context.next = 14;\n                  break;\n                }\n\n                throw new Error('The play() request was interrupted by a call to pause().');\n\n              case 14:\n                this._audioNode.buffer = buffer;\n\n                this._audioNode.connect(this._gainNode);\n\n                this._audioNode.start();\n\n                if (!this._audioElement.srcObject) {\n                  _context.next = 19;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", this._audioElement.play());\n\n              case 19:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n    }\n    /**\n     * Change which device the sound should play through.\n     * @param sinkId - The sink of the device to play sound through.\n     */\n\n  }, {\n    key: \"setSinkId\",\n    value: function setSinkId(sinkId) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(typeof this._audioElement.setSinkId !== 'function')) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                throw new Error('This browser does not support setSinkId.');\n\n              case 2:\n                if (!(sinkId === this.sinkId)) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 4:\n                if (!(sinkId === 'default')) {\n                  _context2.next = 11;\n                  break;\n                }\n\n                if (!this.paused) {\n                  this._gainNode.disconnect(this._destination);\n                }\n\n                this._audioElement.srcObject = null;\n                this._destination = this._audioContext.destination;\n\n                this._gainNode.connect(this._destination);\n\n                this._sinkId = sinkId;\n                return _context2.abrupt(\"return\");\n\n              case 11:\n                _context2.next = 13;\n                return this._audioElement.setSinkId(sinkId);\n\n              case 13:\n                if (!this._audioElement.srcObject) {\n                  _context2.next = 15;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 15:\n                this._gainNode.disconnect(this._audioContext.destination);\n\n                this._destination = this._audioContext.createMediaStreamDestination();\n                this._audioElement.srcObject = this._destination.stream;\n                this._sinkId = sinkId;\n\n                this._gainNode.connect(this._destination);\n\n              case 20:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n    }\n    /**\n     * Create a Deferred for a Promise that will be resolved when .src is set or rejected\n     *   when .pause is called.\n     */\n\n  }, {\n    key: \"_createPlayDeferred\",\n    value: function _createPlayDeferred() {\n      var deferred = new Deferred_1.default();\n\n      this._pendingPlayDeferreds.push(deferred);\n\n      return deferred;\n    }\n    /**\n     * Stop current playback and load a sound file.\n     * @param src - The source URL of the file to load\n     */\n\n  }, {\n    key: \"_load\",\n    value: function _load(src) {\n      var _this3 = this;\n\n      if (this._src && this._src !== src) {\n        this.pause();\n      }\n\n      this._src = src;\n      this._bufferPromise = new Promise(function (resolve, reject) {\n        return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee3() {\n          var buffer;\n          return _regenerator2.default.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  if (src) {\n                    _context3.next = 2;\n                    break;\n                  }\n\n                  return _context3.abrupt(\"return\", this._createPlayDeferred().promise);\n\n                case 2:\n                  _context3.next = 4;\n                  return bufferSound(this._audioContext, this._XMLHttpRequest, src);\n\n                case 4:\n                  buffer = _context3.sent;\n                  this.dispatchEvent('canplaythrough');\n                  resolve(buffer);\n\n                case 7:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3, this);\n        }));\n      });\n    }\n    /**\n     * Reject all deferreds for the Play promise.\n     * @param reason\n     */\n\n  }, {\n    key: \"_rejectPlayDeferreds\",\n    value: function _rejectPlayDeferreds(reason) {\n      var deferreds = this._pendingPlayDeferreds;\n      deferreds.splice(0, deferreds.length).forEach(function (_ref) {\n        var reject = _ref.reject;\n        return reject(reason);\n      });\n    }\n    /**\n     * Resolve all deferreds for the Play promise.\n     * @param result\n     */\n\n  }, {\n    key: \"_resolvePlayDeferreds\",\n    value: function _resolvePlayDeferreds(result) {\n      var deferreds = this._pendingPlayDeferreds;\n      deferreds.splice(0, deferreds.length).forEach(function (_ref2) {\n        var resolve = _ref2.resolve;\n        return resolve(result);\n      });\n    }\n  }, {\n    key: \"destination\",\n    get: function get() {\n      return this._destination;\n    }\n  }, {\n    key: \"loop\",\n    get: function get() {\n      return this._loop;\n    },\n    set: function set(shouldLoop) {\n      // If a sound is already looping, it should continue playing\n      //   the current playthrough and then stop.\n      if (!shouldLoop && this.loop && !this.paused) {\n        var _pauseAfterPlaythrough = function _pauseAfterPlaythrough() {\n          self._audioNode.removeEventListener('ended', _pauseAfterPlaythrough);\n\n          self.pause();\n        };\n\n        var self = this;\n\n        this._audioNode.addEventListener('ended', _pauseAfterPlaythrough);\n      }\n\n      this._loop = shouldLoop;\n    }\n    /**\n     * Whether the audio element is muted.\n     */\n\n  }, {\n    key: \"muted\",\n    get: function get() {\n      return this._gainNode.gain.value === 0;\n    },\n    set: function set(shouldBeMuted) {\n      this._gainNode.gain.value = shouldBeMuted ? 0 : 1;\n    }\n    /**\n     * Whether the sound is paused. this._audioNode only exists when sound is playing;\n     *   otherwise AudioPlayer is considered paused.\n     */\n\n  }, {\n    key: \"paused\",\n    get: function get() {\n      return this._audioNode === null;\n    }\n  }, {\n    key: \"src\",\n    get: function get() {\n      return this._src;\n    },\n    set: function set(src) {\n      this._load(src);\n    }\n    /**\n     * The srcObject of the HTMLMediaElement\n     */\n\n  }, {\n    key: \"srcObject\",\n    get: function get() {\n      return this._audioElement.srcObject;\n    },\n    set: function set(srcObject) {\n      this._audioElement.srcObject = srcObject;\n    }\n  }, {\n    key: \"sinkId\",\n    get: function get() {\n      return this._sinkId;\n    }\n  }]);\n\n  return AudioPlayer;\n}(EventTarget_1.default);\n\nexports.default = AudioPlayer;\n/**\n * Use XMLHttpRequest to load the AudioBuffer of a remote audio asset.\n * @private\n * @param context - The AudioContext to use to decode the audio data\n * @param RequestFactory - The XMLHttpRequest factory to build\n * @param src - The URL of the audio asset to load.\n * @returns A Promise containing the decoded AudioBuffer.\n */\n// tslint:disable-next-line:variable-name\n\nfunction bufferSound(context, RequestFactory, src) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee4() {\n    var request, event;\n    return _regenerator2.default.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            request = new RequestFactory();\n            request.open('GET', src, true);\n            request.responseType = 'arraybuffer';\n            _context4.next = 5;\n            return new Promise(function (resolve) {\n              request.addEventListener('load', resolve);\n              request.send();\n            });\n\n          case 5:\n            event = _context4.sent;\n            _context4.prev = 6;\n            return _context4.abrupt(\"return\", context.decodeAudioData(event.target.response));\n\n          case 10:\n            _context4.prev = 10;\n            _context4.t0 = _context4[\"catch\"](6);\n            return _context4.abrupt(\"return\", new Promise(function (resolve) {\n              context.decodeAudioData(event.target.response, resolve);\n            }));\n\n          case 13:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, this, [[6, 10]]);\n  }));\n}","map":{"version":3,"sources":["/root/twilio-phone-client/node_modules/@twilio/audioplayer/es5/AudioPlayer.js"],"names":["_regenerator","require","_regenerator2","_interopRequireDefault","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","obj","__esModule","default","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","constructor","value","setPrototypeOf","__proto__","__awaiter","undefined","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","exports","Deferred_1","EventTarget_1","AudioPlayer","_EventTarget_1$defaul","audioContext","srcOrOptions","arguments","options","_this","getPrototypeOf","_audioNode","_pendingPlayDeferreds","_loop","_src","_sinkId","_audioContext","_audioElement","AudioFactory","Audio","_bufferPromise","_createPlayDeferred","promise","_destination","destination","_gainNode","createGain","connect","_XMLHttpRequest","XMLHttpRequestFactory","XMLHttpRequest","addEventListener","_resolvePlayDeferreds","src","load","_load","pause","paused","stop","disconnect","_rejectPlayDeferreds","Error","play","mark","_callee","_this2","buffer","wrap","_callee$","_context","prev","abrupt","createBufferSource","loop","dispatchEvent","sent","start","srcObject","setSinkId","sinkId","_callee2","_callee2$","_context2","createMediaStreamDestination","stream","deferred","push","_this3","_callee3","_callee3$","_context3","bufferSound","reason","deferreds","splice","forEach","_ref","_ref2","get","set","shouldLoop","_pauseAfterPlaythrough","removeEventListener","gain","shouldBeMuted","context","RequestFactory","_callee4","request","event","_callee4$","_context4","open","responseType","send","decodeAudioData","response","t0"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) {\n            try {\n                step(generator.next(value));\n            } catch (e) {\n                reject(e);\n            }\n        }\n        function rejected(value) {\n            try {\n                step(generator[\"throw\"](value));\n            } catch (e) {\n                reject(e);\n            }\n        }\n        function step(result) {\n            result.done ? resolve(result.value) : new P(function (resolve) {\n                resolve(result.value);\n            }).then(fulfilled, rejected);\n        }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Deferred_1 = require(\"./Deferred\");\nvar EventTarget_1 = require(\"./EventTarget\");\n/**\n * An {@link AudioPlayer} is an HTMLAudioElement-like object that uses AudioContext\n *   to circumvent browser limitations.\n */\n\nvar AudioPlayer = function (_EventTarget_1$defaul) {\n    _inherits(AudioPlayer, _EventTarget_1$defaul);\n\n    /**\n     * @private\n     */\n    function AudioPlayer(audioContext) {\n        var srcOrOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n        _classCallCheck(this, AudioPlayer);\n\n        /**\n         * The AudioBufferSourceNode of the actively loaded sound. Null if a sound\n         *   has not been loaded yet. This is re-used for each time the sound is\n         *   played.\n         */\n        var _this = _possibleConstructorReturn(this, (AudioPlayer.__proto__ || Object.getPrototypeOf(AudioPlayer)).call(this));\n\n        _this._audioNode = null;\n        /**\n         * An Array of deferred-like objects for each pending `play` Promise. When\n         *   .pause() is called or .src is set, all pending play Promises are\n         *   immediately rejected.\n         */\n        _this._pendingPlayDeferreds = [];\n        /**\n         * Whether or not the audio element should loop. If disabled during playback,\n         *   playing continues until the sound ends and then stops looping.\n         */\n        _this._loop = false;\n        /**\n         * The source URL of the sound to play. When set, the currently playing sound will stop.\n         */\n        _this._src = '';\n        /**\n         * The current sinkId of the device audio is being played through.\n         */\n        _this._sinkId = 'default';\n        if (typeof srcOrOptions !== 'string') {\n            options = srcOrOptions;\n        }\n        _this._audioContext = audioContext;\n        _this._audioElement = new (options.AudioFactory || Audio)();\n        _this._bufferPromise = _this._createPlayDeferred().promise;\n        _this._destination = _this._audioContext.destination;\n        _this._gainNode = _this._audioContext.createGain();\n        _this._gainNode.connect(_this._destination);\n        _this._XMLHttpRequest = options.XMLHttpRequestFactory || XMLHttpRequest;\n        _this.addEventListener('canplaythrough', function () {\n            _this._resolvePlayDeferreds();\n        });\n        if (typeof srcOrOptions === 'string') {\n            _this.src = srcOrOptions;\n        }\n        return _this;\n    }\n\n    _createClass(AudioPlayer, [{\n        key: \"load\",\n\n        /**\n         * Stop any ongoing playback and reload the source file.\n         */\n        value: function load() {\n            this._load(this._src);\n        }\n        /**\n         * Pause the audio coming from this AudioPlayer. This will reject any pending\n         *   play Promises.\n         */\n\n    }, {\n        key: \"pause\",\n        value: function pause() {\n            if (this.paused) {\n                return;\n            }\n            this._audioElement.pause();\n            this._audioNode.stop();\n            this._audioNode.disconnect(this._gainNode);\n            this._audioNode = null;\n            this._rejectPlayDeferreds(new Error('The play() request was interrupted by a call to pause().'));\n        }\n        /**\n         * Play the sound. If the buffer hasn't loaded yet, wait for the buffer to load. If\n         *   the source URL is not set yet, this Promise will remain pending until a source\n         *   URL is set.\n         */\n\n    }, {\n        key: \"play\",\n        value: function play() {\n            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n                var _this2 = this;\n\n                var buffer;\n                return _regenerator2.default.wrap(function _callee$(_context) {\n                    while (1) {\n                        switch (_context.prev = _context.next) {\n                            case 0:\n                                if (this.paused) {\n                                    _context.next = 6;\n                                    break;\n                                }\n\n                                _context.next = 3;\n                                return this._bufferPromise;\n\n                            case 3:\n                                if (this.paused) {\n                                    _context.next = 5;\n                                    break;\n                                }\n\n                                return _context.abrupt(\"return\");\n\n                            case 5:\n                                throw new Error('The play() request was interrupted by a call to pause().');\n\n                            case 6:\n                                this._audioNode = this._audioContext.createBufferSource();\n                                this._audioNode.loop = this.loop;\n                                this._audioNode.addEventListener('ended', function () {\n                                    if (_this2._audioNode && _this2._audioNode.loop) {\n                                        return;\n                                    }\n                                    _this2.dispatchEvent('ended');\n                                });\n                                _context.next = 11;\n                                return this._bufferPromise;\n\n                            case 11:\n                                buffer = _context.sent;\n\n                                if (!this.paused) {\n                                    _context.next = 14;\n                                    break;\n                                }\n\n                                throw new Error('The play() request was interrupted by a call to pause().');\n\n                            case 14:\n                                this._audioNode.buffer = buffer;\n                                this._audioNode.connect(this._gainNode);\n                                this._audioNode.start();\n\n                                if (!this._audioElement.srcObject) {\n                                    _context.next = 19;\n                                    break;\n                                }\n\n                                return _context.abrupt(\"return\", this._audioElement.play());\n\n                            case 19:\n                            case \"end\":\n                                return _context.stop();\n                        }\n                    }\n                }, _callee, this);\n            }));\n        }\n        /**\n         * Change which device the sound should play through.\n         * @param sinkId - The sink of the device to play sound through.\n         */\n\n    }, {\n        key: \"setSinkId\",\n        value: function setSinkId(sinkId) {\n            return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n                return _regenerator2.default.wrap(function _callee2$(_context2) {\n                    while (1) {\n                        switch (_context2.prev = _context2.next) {\n                            case 0:\n                                if (!(typeof this._audioElement.setSinkId !== 'function')) {\n                                    _context2.next = 2;\n                                    break;\n                                }\n\n                                throw new Error('This browser does not support setSinkId.');\n\n                            case 2:\n                                if (!(sinkId === this.sinkId)) {\n                                    _context2.next = 4;\n                                    break;\n                                }\n\n                                return _context2.abrupt(\"return\");\n\n                            case 4:\n                                if (!(sinkId === 'default')) {\n                                    _context2.next = 11;\n                                    break;\n                                }\n\n                                if (!this.paused) {\n                                    this._gainNode.disconnect(this._destination);\n                                }\n                                this._audioElement.srcObject = null;\n                                this._destination = this._audioContext.destination;\n                                this._gainNode.connect(this._destination);\n                                this._sinkId = sinkId;\n                                return _context2.abrupt(\"return\");\n\n                            case 11:\n                                _context2.next = 13;\n                                return this._audioElement.setSinkId(sinkId);\n\n                            case 13:\n                                if (!this._audioElement.srcObject) {\n                                    _context2.next = 15;\n                                    break;\n                                }\n\n                                return _context2.abrupt(\"return\");\n\n                            case 15:\n                                this._gainNode.disconnect(this._audioContext.destination);\n                                this._destination = this._audioContext.createMediaStreamDestination();\n                                this._audioElement.srcObject = this._destination.stream;\n                                this._sinkId = sinkId;\n                                this._gainNode.connect(this._destination);\n\n                            case 20:\n                            case \"end\":\n                                return _context2.stop();\n                        }\n                    }\n                }, _callee2, this);\n            }));\n        }\n        /**\n         * Create a Deferred for a Promise that will be resolved when .src is set or rejected\n         *   when .pause is called.\n         */\n\n    }, {\n        key: \"_createPlayDeferred\",\n        value: function _createPlayDeferred() {\n            var deferred = new Deferred_1.default();\n            this._pendingPlayDeferreds.push(deferred);\n            return deferred;\n        }\n        /**\n         * Stop current playback and load a sound file.\n         * @param src - The source URL of the file to load\n         */\n\n    }, {\n        key: \"_load\",\n        value: function _load(src) {\n            var _this3 = this;\n\n            if (this._src && this._src !== src) {\n                this.pause();\n            }\n            this._src = src;\n            this._bufferPromise = new Promise(function (resolve, reject) {\n                return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee3() {\n                    var buffer;\n                    return _regenerator2.default.wrap(function _callee3$(_context3) {\n                        while (1) {\n                            switch (_context3.prev = _context3.next) {\n                                case 0:\n                                    if (src) {\n                                        _context3.next = 2;\n                                        break;\n                                    }\n\n                                    return _context3.abrupt(\"return\", this._createPlayDeferred().promise);\n\n                                case 2:\n                                    _context3.next = 4;\n                                    return bufferSound(this._audioContext, this._XMLHttpRequest, src);\n\n                                case 4:\n                                    buffer = _context3.sent;\n\n                                    this.dispatchEvent('canplaythrough');\n                                    resolve(buffer);\n\n                                case 7:\n                                case \"end\":\n                                    return _context3.stop();\n                            }\n                        }\n                    }, _callee3, this);\n                }));\n            });\n        }\n        /**\n         * Reject all deferreds for the Play promise.\n         * @param reason\n         */\n\n    }, {\n        key: \"_rejectPlayDeferreds\",\n        value: function _rejectPlayDeferreds(reason) {\n            var deferreds = this._pendingPlayDeferreds;\n            deferreds.splice(0, deferreds.length).forEach(function (_ref) {\n                var reject = _ref.reject;\n                return reject(reason);\n            });\n        }\n        /**\n         * Resolve all deferreds for the Play promise.\n         * @param result\n         */\n\n    }, {\n        key: \"_resolvePlayDeferreds\",\n        value: function _resolvePlayDeferreds(result) {\n            var deferreds = this._pendingPlayDeferreds;\n            deferreds.splice(0, deferreds.length).forEach(function (_ref2) {\n                var resolve = _ref2.resolve;\n                return resolve(result);\n            });\n        }\n    }, {\n        key: \"destination\",\n        get: function get() {\n            return this._destination;\n        }\n    }, {\n        key: \"loop\",\n        get: function get() {\n            return this._loop;\n        },\n        set: function set(shouldLoop) {\n            // If a sound is already looping, it should continue playing\n            //   the current playthrough and then stop.\n            if (!shouldLoop && this.loop && !this.paused) {\n                var _pauseAfterPlaythrough = function _pauseAfterPlaythrough() {\n                    self._audioNode.removeEventListener('ended', _pauseAfterPlaythrough);\n                    self.pause();\n                };\n\n                var self = this;\n\n                this._audioNode.addEventListener('ended', _pauseAfterPlaythrough);\n            }\n            this._loop = shouldLoop;\n        }\n        /**\n         * Whether the audio element is muted.\n         */\n\n    }, {\n        key: \"muted\",\n        get: function get() {\n            return this._gainNode.gain.value === 0;\n        },\n        set: function set(shouldBeMuted) {\n            this._gainNode.gain.value = shouldBeMuted ? 0 : 1;\n        }\n        /**\n         * Whether the sound is paused. this._audioNode only exists when sound is playing;\n         *   otherwise AudioPlayer is considered paused.\n         */\n\n    }, {\n        key: \"paused\",\n        get: function get() {\n            return this._audioNode === null;\n        }\n    }, {\n        key: \"src\",\n        get: function get() {\n            return this._src;\n        },\n        set: function set(src) {\n            this._load(src);\n        }\n        /**\n         * The srcObject of the HTMLMediaElement\n         */\n\n    }, {\n        key: \"srcObject\",\n        get: function get() {\n            return this._audioElement.srcObject;\n        },\n        set: function set(srcObject) {\n            this._audioElement.srcObject = srcObject;\n        }\n    }, {\n        key: \"sinkId\",\n        get: function get() {\n            return this._sinkId;\n        }\n    }]);\n\n    return AudioPlayer;\n}(EventTarget_1.default);\n\nexports.default = AudioPlayer;\n/**\n * Use XMLHttpRequest to load the AudioBuffer of a remote audio asset.\n * @private\n * @param context - The AudioContext to use to decode the audio data\n * @param RequestFactory - The XMLHttpRequest factory to build\n * @param src - The URL of the audio asset to load.\n * @returns A Promise containing the decoded AudioBuffer.\n */\n// tslint:disable-next-line:variable-name\nfunction bufferSound(context, RequestFactory, src) {\n    return __awaiter(this, void 0, void 0, /*#__PURE__*/_regenerator2.default.mark(function _callee4() {\n        var request, event;\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n            while (1) {\n                switch (_context4.prev = _context4.next) {\n                    case 0:\n                        request = new RequestFactory();\n\n                        request.open('GET', src, true);\n                        request.responseType = 'arraybuffer';\n                        _context4.next = 5;\n                        return new Promise(function (resolve) {\n                            request.addEventListener('load', resolve);\n                            request.send();\n                        });\n\n                    case 5:\n                        event = _context4.sent;\n                        _context4.prev = 6;\n                        return _context4.abrupt(\"return\", context.decodeAudioData(event.target.response));\n\n                    case 10:\n                        _context4.prev = 10;\n                        _context4.t0 = _context4[\"catch\"](6);\n                        return _context4.abrupt(\"return\", new Promise(function (resolve) {\n                            context.decodeAudioData(event.target.response, resolve);\n                        }));\n\n                    case 13:\n                    case \"end\":\n                        return _context4.stop();\n                }\n            }\n        }, _callee4, this, [[6, 10]]);\n    }));\n}\n//# sourceMappingURL=AudioPlayer.js.map"]},"metadata":{},"sourceType":"script"}